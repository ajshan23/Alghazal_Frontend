import{r as b,j as a,m as U}from"./index-DGJe0h3_.js";import{C as K}from"./ConfirmDialog-YYBqiHbX.js";import{t as _,N as k}from"./toast-DO-2lc6K.js";import{d as Q,c as W,f as z,h as G,i as J,j as Z,k as X,l as F,m as ee,n as ae}from"./api-BtuCWMnW.js";import"./Alert-DQXwajGW.js";import"./index-BoJTJILF.js";import"./Badge-Bbo5QMXa.js";import{B as te}from"./Button-CQnyK8gC.js";import{D as P}from"./index-CIbY2fIk.js";import"./Card-BM0eEatX.js";import"./index-BGu1WFOe.js";import"./Dialog-Cg-T3Ihd.js";import{D as oe}from"./Drawer-CLVcPT2Q.js";import"./index-Bv5Pt-_w.js";import{a as v}from"./FormItem-CS5k__-u.js";import"./useUniqueId-D1PCBCG9.js";import"./Input-k-NORbeb.js";import"./Upload-BgdP_nuh.js";import"./index-1STGvrfH.js";import"./index-nUD77ZMI.js";import"./ScrollBar-nZR6U59l.js";import{S as N}from"./Select-C04L81V4.js";import"./Tag-BPJKpn67.js";import{F as ne,a as le,b as x}from"./formik.esm-Bd7bPKfV.js";import{c as se}from"./index.esm-Kw287qmC.js";import{d as ie}from"./index-C8abeZB5.js";import{f as O}from"./format-CBpsKyOP.js";import{Z as re}from"./index-DB0cxP-C.js";const Oe=({isOpen:y,onClose:m,bill:o,refetch:i,reportType:c})=>{const[n,g]=b.useState(!1);if(console.log(c,"123 reportType inn BillDeleteConfirmation"),!y||!o)return null;const D=()=>{var u,h;switch(o.billType||o.reportType||c){case"general":return`Delete General Bill ${o.invoiceNo?`#${o.invoiceNo}`:""}`;case"fuel":return"Delete Fuel Bill";case"mess":return"Delete Mess Bill";case"vehicle":return`Delete Vehicle Bill ${(u=o.vehicle)!=null&&u.vehicleNumber?`(Vehicle ${o.vehicle.vehicleNumber})`:""}`;case"accommodation":return`Delete Accommodation Bill ${(h=o.accommodation)!=null&&h.location?`(${o.accommodation.location})`:""}`;case"adib":return"Delete Adib Report";case"expense":return"Delete Expense Report";case"profit":return"Delete Profit Report";case"labour":return"Delete Labour Expenses Report";case"payroll":return"Delete Payroll Report";case"visaExpense":return"Delete Visa Expense Report";default:return"Delete Bill"}};console.log(o,"123 bill.billType inn BillDeleteConfirmation");const w=()=>{var u,h;switch(o.billType||o.reportType||c){case"general":return`Are you sure you want to delete this general bill${o.invoiceNo?` (Invoice #${o.invoiceNo})`:""}? This action cannot be undone.`;case"fuel":return"Are you sure you want to delete this fuel bill? This action cannot be undone.";case"mess":return"Are you sure you want to delete this mess bill? This action cannot be undone.";case"vehicle":return`Are you sure you want to delete this vehicle bill${(u=o.vehicle)!=null&&u.vehicleNumber?` for vehicle ${o.vehicle.vehicleNumber}`:""}? This action cannot be undone.`;case"accommodation":return`Are you sure you want to delete this accommodation bill${(h=o.accommodation)!=null&&h.location?` for ${o.accommodation.location}`:""}? This action cannot be undone.`;case"adib":return"Are you sure you want to delete this adib report? This action cannot be undone.";case"expense":return"Are you sure you want to delete this expense report? This action cannot be undone.";case"profit":return"Are you sure you want to delete this profit report? This action cannot be undone.";case"labour":return"Are you sure you want to delete this labour expenses report? This action cannot be undone.";case"payroll":return"Are you sure you want to delete this payroll report? This action cannot be undone.";case"visaExpense":return"Are you sure you want to delete this visa expense report? This action cannot be undone.";default:return"Are you sure you want to delete this bill? This action cannot be undone."}},S=async()=>{var u,h;g(!0);try{await o.billType?Q(o._id):c==="profit"?W(o._id):c==="labour"?z(o._id):c==="payroll"?G(o._id):c==="visaExpense"?J(o._id):Z(o._id),i(),_.push(a.jsx(k,{title:`${D()} deleted successfully`,type:"success",duration:2500,children:o.billType?"The bill has been successfully deleted.":"The report has been successfully deleted."}),{placement:"top-center"}),m()}catch(p){console.error("Delete failed:",p),_.push(a.jsx(k,{title:`Failed to delete ${D()}`,type:"danger",duration:2500,children:((h=(u=p==null?void 0:p.response)==null?void 0:u.data)==null?void 0:h.message)||p.message||"Something went wrong"}),{placement:"top-center"})}finally{g(!1)}};return a.jsxs(K,{isOpen:y,type:"danger",title:D(),confirmButtonColor:"red-600",onClose:m,onRequestClose:m,onCancel:m,onConfirm:S,confirmButtonDisabled:n,children:[a.jsx("p",{children:w()}),n&&a.jsx("div",{className:"mt-4 flex justify-center",children:a.jsx("div",{className:"w-6 h-6 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"})})]})},I=[{label:"ADVANCE",value:"advance"},{label:"ADIB",value:"adib"},{label:"Cash",value:"cash"},{label:"MASHREQ CARD",value:"mashreq_card"},{label:"CREDIT",value:"credit"},{label:"ADCB CARD",value:"adcb_card"},{label:"ADCB BANK",value:"adcb_bank"},{label:"MASHREQ BANK",value:"mashreq_bank"},{label:"OWNER PERSONAL PAY",value:"owner_personal_pay"},{label:"MR.SYED PAY",value:"mr_syed_pay"},{label:"OTHER PAY",value:"other_pay"},{label:"CHEQUE",value:"cheque"},{label:"WIO CARD",value:"wio_card"},{label:"WIO BANK",value:"wio_bank"}],Ie=({isOpen:y,onClose:m,onRequestClose:o,billType:i,onApplyFilters:c,currentFilters:n})=>{const[g,D]=b.useState([]),[w,S]=b.useState([]),[u,h]=b.useState([]),[p,T]=b.useState([]),[E,L]=b.useState(!0);b.useEffect(()=>{(async()=>{var r,f,C,A,t,l,e,M;try{const[j,R,B,V]=await Promise.all([X(),F(),ee(),ae()]);D(((f=(r=j==null?void 0:j.data)==null?void 0:r.shops)==null?void 0:f.map(d=>({label:`${d.shopName} (${d.shopNo})`,value:d._id})))||[]),S(((A=(C=R==null?void 0:R.data)==null?void 0:C.categories)==null?void 0:A.map(d=>({label:d.name,value:d._id})))||[]),h(((l=(t=B==null?void 0:B.data)==null?void 0:t.vehicles)==null?void 0:l.map(d=>({label:d.vehicleNumber,value:d._id})))||[]),T(((M=(e=V==null?void 0:V.data)==null?void 0:e.users)==null?void 0:M.map(d=>({label:`${d.firstName} ${d.lastName}`,value:d._id})))||[])}catch(j){console.error("Error loading filter options",j)}finally{L(!1)}})()},[]);const $=new Date,Y={startDate:(n==null?void 0:n.startDate)||"",endDate:(n==null?void 0:n.endDate)||"",category:(n==null?void 0:n.category)||"",shop:(n==null?void 0:n.shop)||"",vehicleNo:(n==null?void 0:n.vehicleNo)||"",paymentMethod:(n==null?void 0:n.paymentMethod)||"",employee:(n==null?void 0:n.employee)||""},H=s=>{const r={};s.startDate&&(r.startDate=s.startDate),s.endDate&&(r.endDate=s.endDate),s.category&&(r.category=s.category),s.shop&&(r.shop=s.shop),s.vehicleNo&&(r.vehicle=s.vehicleNo),s.paymentMethod&&(r.paymentMethod=s.paymentMethod),s.employee&&(r.employee=s.employee),console.log("Applying Filters from Drawer:",r),c==null||c(r),setTimeout(()=>{m==null||m(new MouseEvent("click"))},100)},q=s=>{s(),c==null||c({startDate:"",endDate:"",category:"",shop:"",vehicle:"",paymentMethod:"",employee:""})};return a.jsx(oe,{title:`Filter ${i.charAt(0).toUpperCase()+i.slice(1)} Bills`,isOpen:y,onClose:m,onRequestClose:o,children:a.jsx(ne,{initialValues:Y,validationSchema:se({}),onSubmit:H,children:({values:s,errors:r,touched:f,resetForm:C,setFieldValue:A})=>a.jsxs(le,{className:"space-y-4",children:[a.jsx(v,{label:"Start Date",invalid:!!r.startDate&&f.startDate,children:a.jsx(x,{name:"startDate",children:({field:t,form:l})=>a.jsx(P,{placeholder:"Select Start Date",value:t.value?new Date(t.value):null,maxDate:$,onChange:e=>l.setFieldValue(t.name,e?O(new Date(e.getFullYear(),e.getMonth(),e.getDate()),"yyyy-MM-dd"):"")})})}),a.jsx(v,{label:"End Date",invalid:!!r.endDate&&f.endDate,children:a.jsx(x,{name:"endDate",children:({field:t,form:l})=>a.jsx(P,{placeholder:"Select End Date",value:t.value?new Date(t.value):null,maxDate:$,onChange:e=>l.setFieldValue(t.name,e?O(new Date(e.getFullYear(),e.getMonth(),e.getDate()),"yyyy-MM-dd"):"")})})}),(i==="general"||i==="mess"||i==="accommodation"||i==="vehicle"||i==="adib")&&a.jsx(v,{label:"Shop Name",children:a.jsx(x,{name:"shop",children:({field:t,form:l})=>a.jsx(N,{placeholder:"Select Shop",options:g,value:g.find(e=>e.value===t.value),onChange:e=>l.setFieldValue(t.name,(e==null?void 0:e.value)||""),onClear:()=>l.setFieldValue(t.name,""),isClearable:!0,loading:E})})}),(i==="general"||i==="adib")&&a.jsx(v,{label:"Category",children:a.jsx(x,{name:"category",children:({field:t,form:l})=>a.jsx(N,{placeholder:"Select Category",options:w,value:w.find(e=>e.value===t.value),onChange:e=>l.setFieldValue(t.name,(e==null?void 0:e.value)||""),onClear:()=>l.setFieldValue(t.name,""),isClearable:!0,loading:E})})}),(i==="vehicle"||i==="fuel")&&a.jsx(v,{label:"Vehicle No",children:a.jsx(x,{name:"vehicleNo",children:({field:t,form:l})=>a.jsx(N,{placeholder:"Select Vehicle",options:u,value:u.find(e=>e.value===t.value),onChange:e=>l.setFieldValue(t.name,(e==null?void 0:e.value)||""),onClear:()=>l.setFieldValue(t.name,""),isClearable:!0,loading:E})})}),["general","mess","fuel","vehicle","accommodation"].includes(i)&&a.jsx(v,{label:"Payment Method",children:a.jsx(x,{name:"paymentMethod",children:({field:t,form:l})=>a.jsx(N,{placeholder:"Select Payment Method",options:I,value:I.find(e=>e.value===t.value),onChange:e=>l.setFieldValue(t.name,(e==null?void 0:e.value)||""),onClear:()=>l.setFieldValue(t.name,""),isClearable:!0})})}),(i==="visaExpense"||i==="labour"||i==="payroll")&&a.jsx(v,{label:"Employee",children:a.jsx(x,{name:"employee",children:({field:t,form:l})=>a.jsx(N,{placeholder:"Select Employee",options:p,value:p.find(e=>e.value===t.value),onChange:e=>l.setFieldValue(t.name,(e==null?void 0:e.value)||""),onClear:()=>l.setFieldValue(t.name,""),isClearable:!0})})}),a.jsxs("div",{className:"mt-8 flex justify-end gap-2",children:[a.jsxs("button",{type:"button",onClick:()=>q(C),className:"flex items-center gap-1 text-sm bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-white px-3 py-1.5 rounded hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors",children:[a.jsx(ie,{className:"text-base"}),"Reset"]}),a.jsx("button",{type:"submit",className:"text-sm bg-blue-600 text-white px-3 py-1.5 rounded hover:bg-blue-700 transition-colors",children:"Apply Filters"})]})]})},`${y}-${JSON.stringify(n)}`)})},Te=({to:y,title:m})=>a.jsx("div",{className:"flex flex-col lg:flex-row lg:items-center gap-2",children:a.jsx(U,{className:"block lg:inline-block md:mb-0 mb-4",to:y,children:a.jsx(te,{block:!0,variant:"solid",size:"sm",icon:a.jsx(re,{}),children:m})})});export{Te as B,Oe as a,Ie as b};
