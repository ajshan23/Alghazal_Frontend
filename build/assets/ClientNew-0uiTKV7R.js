import{r as C,v as U,j as e,a8 as Z}from"./index-DGJe0h3_.js";import{a as _,e as I,c as ee}from"./api-y6wfSwYb.js";import{t as R,N as S}from"./toast-DO-2lc6K.js";import{F as re,a as p}from"./FormItem-CS5k__-u.js";import{B as x}from"./Button-CQnyK8gC.js";import{S as te}from"./StickyFooter-B-P65R3j.js";import{F as ae,a as se,b as g}from"./formik.esm-Bd7bPKfV.js";import{a as D,b as $,c as oe,A as ie}from"./index-CRCxGWKG.js";import{c as ne,b as h}from"./index.esm-Kw287qmC.js";import"./Alert-DQXwajGW.js";import"./index-BoJTJILF.js";import"./Badge-Bbo5QMXa.js";import"./index-CIbY2fIk.js";import"./Card-BM0eEatX.js";import"./index-BGu1WFOe.js";import"./Dialog-Cg-T3Ihd.js";import"./Drawer-CLVcPT2Q.js";import"./index-Bv5Pt-_w.js";import"./useUniqueId-D1PCBCG9.js";import{I as b}from"./Input-k-NORbeb.js";import"./Upload-BgdP_nuh.js";import"./index-1STGvrfH.js";import"./index-nUD77ZMI.js";import"./ScrollBar-nZR6U59l.js";import"./Select-C04L81V4.js";import"./Tag-BPJKpn67.js";import{f as q,Q as le,al as de,am as z,h as me,R as P,an as T,ao as H,ap as ce}from"./index-DB0cxP-C.js";import"./StatusIcon-BdTPNP40.js";import"./CloseButton-CGoFVruc.js";import"./chainedFunction-BxZSneMW.js";import"./proxy-BoP70aqV.js";import"./context-DBc_qd6o.js";import"./index-C4_xw0Qz.js";import"./cloneDeep-DJN0yfLA.js";import"./hoist-non-react-statics.cjs-DodG7NJv.js";import"./floating-ui.react-DD89AqSX.js";import"./floating-ui.dom-B_iSk-nO.js";import"./Views-BFlyERhL.js";import"./_getPrototype-0ulQvO4z.js";import"./index-Blf2GdN6.js";import"./index-CXaN8JhO.js";import"./toString-Dkf6_Dxj.js";import"./index-TU9pDyqH.js";import"./defineProperty-DRmM3rRU.js";import"./typeof-QjJsDpFa.js";const V=ne().shape({clientName:h().required("Client Name Required"),email:h().email("Invalid email format").nullable().notRequired(),clientAddress:h().nullable().notRequired(),pincode:h().matches(/^[0-9]*$/,"Pincode must be numeric").nullable().notRequired(),mobileNumber:h().matches(/^[0-9]*$/,"Mobile number must be digits only").nullable().notRequired(),telephoneNumber:h().matches(/^[0-9]*$/,"Telephone number must be digits only").nullable().notRequired(),trnNumber:h().nullable().notRequired(),accountNumber:h().nullable().notRequired()}),J=C.forwardRef((y,m)=>{const A=U(),{type:O,initialData:f={clientName:"",email:"",clientAddress:"",pincode:"",mobileNumber:"",telephoneNumber:null,trnNumber:"",accountNumber:"",locations:[]},onFormSubmit:L,onDiscard:E,onDelete:B}=y,[i,n]=C.useState(f.locations||[]),k=a=>{const t={};return a.inner.forEach(r=>{t[r.path]=r.message}),t},w=()=>{n([...i,{name:"",buildings:[]}])},N=a=>{const t=[...i];t.splice(a,1),n(t)},j=a=>{const t=[...i];t[a].buildings.push({name:"",apartments:[]}),n(t)},c=(a,t)=>{const r=[...i];r[a].buildings.splice(t,1),n(r)},Q=(a,t)=>{const r=[...i];r[a].buildings[t].apartments.push({number:""}),n(r)},G=(a,t,r)=>{const l=[...i];l[a].buildings[t].apartments.splice(r,1),n(l)},K=(a,t)=>{const r=[...i];r[a].name=t,n(r)},W=(a,t,r)=>{const l=[...i];l[a].buildings[t].name=r,n(l)},X=(a,t,r,l)=>{const u=[...i];u[a].buildings[t].apartments[r].number=l,n(u)};return e.jsx(ae,{innerRef:m,initialValues:{...f,locations:i},validationSchema:V,onSubmit:async(a,{setSubmitting:t})=>{try{const l={...Object.entries(a).reduce((d,[s,o])=>(s==="clientName"?d[s]=o||"":o&&typeof o=="string"&&o.trim()!==""?d[s]=o.trim():o!=null&&o!==""&&(d[s]=o),d),{}),locations:i.filter(d=>d.name.trim()!=="").map(d=>({name:d.name.trim(),buildings:d.buildings.filter(s=>s.name.trim()!=="").map(s=>({name:s.name.trim(),apartments:s.apartments.filter(o=>o.number.trim()!=="").map(o=>({number:o.number.trim()}))}))}))};console.log("Form data to be submitted:",JSON.stringify(l,null,2));const u=await L(l,t);u!=null&&u.id?A(`/client-view/${u.id}`):O==="edit"&&f.id&&A(`/client-view/${f.id}`)}catch(r){console.error("Form submission error:",r)}},validateOnBlur:!0,validateOnChange:!1,validate:a=>{try{return V.validateSync(a,{abortEarly:!1}),{}}catch(t){return k(t)}},children:({values:a,touched:t,errors:r,isSubmitting:l,handleSubmit:u})=>e.jsx(se,{onSubmit:u,children:e.jsxs(re,{children:[e.jsxs("div",{className:"bg-gradient-to-br from-white via-blue-50 to-indigo-50 dark:from-gray-800 dark:via-gray-850 dark:to-gray-900 rounded-2xl p-8 border border-blue-200 dark:border-gray-700 shadow-lg mb-8",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"p-3 bg-gradient-to-r from-blue-500 to-indigo-600 rounded-xl",children:e.jsx(q,{className:"text-2xl text-white"})}),e.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-white",children:"Client Information"})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-6 border border-gray-200 dark:border-gray-700 shadow-sm",children:e.jsx(p,{label:e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(q,{className:"text-lg text-blue-600"}),e.jsx("span",{className:"font-semibold text-gray-800 dark:text-white text-lg",children:"Client Name"}),e.jsx("span",{className:"text-red-500",children:"*"})]}),invalid:!!(r.clientName&&t.clientName),errorMessage:r.clientName,children:e.jsx(g,{type:"text",autoComplete:"off",name:"clientName",placeholder:"Enter client name...",component:b,className:"text-lg py-3 border-2 border-blue-200 dark:border-gray-600 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 rounded-lg"})})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-6 border border-gray-200 dark:border-gray-700 shadow-sm",children:e.jsx(p,{label:e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(le,{className:"text-lg text-blue-600"}),e.jsx("span",{className:"font-semibold text-gray-800 dark:text-white text-lg",children:"Email Address"})]}),invalid:!!(r.email&&t.email),errorMessage:r.email,children:e.jsx(g,{type:"text",autoComplete:"off",name:"email",placeholder:"Enter email address (optional)...",component:b,className:"text-lg py-3 border-2 border-blue-200 dark:border-gray-600 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 rounded-lg"})})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-6 border border-gray-200 dark:border-gray-700 shadow-sm",children:e.jsx(p,{label:e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(de,{className:"text-lg text-blue-600"}),e.jsx("span",{className:"font-semibold text-gray-800 dark:text-white text-lg",children:"Client Address"})]}),invalid:!!(r.clientAddress&&t.clientAddress),errorMessage:r.clientAddress,children:e.jsx(g,{as:"textarea",autoComplete:"off",name:"clientAddress",placeholder:"Enter client address (optional)...",component:b,textArea:!0,rows:3,className:"text-lg py-3 border-2 border-blue-200 dark:border-gray-600 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 rounded-lg resize-none"})})}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-6 border border-gray-200 dark:border-gray-700 shadow-sm",children:e.jsx(p,{label:e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(z,{className:"text-lg text-blue-600"}),e.jsx("span",{className:"font-semibold text-gray-800 dark:text-white text-lg",children:"Pincode"})]}),invalid:!!(r.pincode&&t.pincode),errorMessage:r.pincode,children:e.jsx(g,{type:"text",autoComplete:"off",name:"pincode",placeholder:"Enter pincode (optional)...",component:b,className:"text-lg py-3 border-2 border-blue-200 dark:border-gray-600 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 rounded-lg"})})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-6 border border-gray-200 dark:border-gray-700 shadow-sm",children:e.jsx(p,{label:e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(me,{className:"text-lg text-blue-600"}),e.jsx("span",{className:"font-semibold text-gray-800 dark:text-white text-lg",children:"TRN Number"})]}),invalid:!!(r.trnNumber&&t.trnNumber),errorMessage:r.trnNumber,children:e.jsx(g,{type:"text",autoComplete:"off",name:"trnNumber",placeholder:"Enter TRN number (optional)...",component:b,className:"text-lg py-3 border-2 border-blue-200 dark:border-gray-600 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 rounded-lg"})})})]}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-6 border border-gray-200 dark:border-gray-700 shadow-sm",children:e.jsx(p,{label:e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(z,{className:"text-lg text-blue-600"}),e.jsx("span",{className:"font-semibold text-gray-800 dark:text-white text-lg",children:"Account Number"})]}),invalid:!!(r.accountNumber&&t.accountNumber),errorMessage:r.accountNumber,children:e.jsx(g,{type:"text",autoComplete:"off",name:"accountNumber",placeholder:"Enter account number (optional)...",component:b,className:"text-lg py-3 border-2 border-blue-200 dark:border-gray-600 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 rounded-lg"})})}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-6 border border-gray-200 dark:border-gray-700 shadow-sm",children:e.jsx(p,{label:e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(P,{className:"text-lg text-blue-600"}),e.jsx("span",{className:"font-semibold text-gray-800 dark:text-white text-lg",children:"Mobile Number"})]}),invalid:!!(r.mobileNumber&&t.mobileNumber),errorMessage:r.mobileNumber,children:e.jsx(g,{type:"text",autoComplete:"off",name:"mobileNumber",placeholder:"Enter mobile number (optional)...",component:b,className:"text-lg py-3 border-2 border-blue-200 dark:border-gray-600 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 rounded-lg"})})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-6 border border-gray-200 dark:border-gray-700 shadow-sm",children:e.jsx(p,{label:e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(P,{className:"text-lg text-blue-600"}),e.jsx("span",{className:"font-semibold text-gray-800 dark:text-white text-lg",children:"Telephone Number"})]}),invalid:!!(r.telephoneNumber&&t.telephoneNumber),errorMessage:r.telephoneNumber,children:e.jsx(g,{type:"text",autoComplete:"off",name:"telephoneNumber",placeholder:"Enter telephone number (optional)...",component:b,className:"text-lg py-3 border-2 border-blue-200 dark:border-gray-600 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 rounded-lg"})})})]})]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-white via-green-50 to-teal-50 dark:from-gray-800 dark:via-gray-850 dark:to-gray-900 rounded-2xl p-8 border border-green-200 dark:border-gray-700 shadow-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 bg-gradient-to-r from-green-500 to-teal-600 rounded-xl",children:e.jsx(T,{className:"text-2xl text-white"})}),e.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-white",children:"Location - Building - Apartment Structure"})]}),e.jsx(x,{size:"lg",variant:"solid",icon:e.jsx(D,{}),onClick:w,type:"button",className:"px-6 py-3 bg-gradient-to-r from-green-600 to-teal-700 hover:from-green-700 hover:to-teal-800 text-white font-semibold rounded-xl shadow-lg hover:shadow-xl transition-all duration-200",children:"Add Location"})]}),i.length===0&&e.jsxs("div",{className:"text-center py-12 text-gray-500 dark:text-gray-400 bg-white dark:bg-gray-800 rounded-xl border border-dashed border-gray-300 dark:border-gray-600",children:[e.jsx(H,{className:"mx-auto text-4xl mb-4 text-gray-300 dark:text-gray-600"}),e.jsx("p",{className:"text-lg mb-1",children:"No locations added yet"}),e.jsx("p",{className:"text-sm",children:'Click "Add Location" to get started (Optional)'})]}),e.jsx("div",{className:"space-y-6",children:i.map((d,s)=>e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 shadow-sm overflow-hidden",children:[e.jsxs("div",{className:"flex items-center p-6 border-b dark:border-gray-600 bg-gradient-to-r from-gray-50 to-gray-100 dark:from-gray-700 dark:to-gray-800",children:[e.jsx(T,{className:"mr-3 text-xl text-green-600"}),e.jsx(g,{type:"text",autoComplete:"off",value:d.name,onChange:o=>K(s,o.target.value),placeholder:"Enter location name...",component:b,className:"flex-grow mr-4 text-lg py-3 border-2 border-green-200 dark:border-gray-600 focus:border-green-500 focus:ring-2 focus:ring-green-200 rounded-lg"}),e.jsx(x,{size:"sm",variant:"plain",color:"red",icon:e.jsx($,{}),onClick:()=>N(s),className:"hover:bg-red-50 dark:hover:bg-red-900/20 px-3 py-2 rounded-lg",type:"button"})]}),e.jsxs("div",{className:"p-6",children:[d.buildings.length===0&&e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400 bg-gray-50 dark:bg-gray-700/30 rounded-lg mb-6",children:[e.jsx(H,{className:"mx-auto text-3xl mb-2 text-gray-300 dark:text-gray-600"}),e.jsx("p",{children:"No buildings in this location"})]}),e.jsx("div",{className:"space-y-4",children:d.buildings.map((o,v)=>e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/30 rounded-lg border border-gray-200 dark:border-gray-600 overflow-hidden",children:[e.jsxs("div",{className:"flex items-center p-4 border-b dark:border-gray-600 bg-white dark:bg-gray-800",children:[e.jsx(H,{className:"mr-3 text-lg text-green-600"}),e.jsx(g,{type:"text",autoComplete:"off",value:o.name,onChange:F=>W(s,v,F.target.value),placeholder:"Enter building name...",component:b,className:"flex-grow mr-4 text-lg py-3 border-2 border-green-200 dark:border-gray-600 focus:border-green-500 focus:ring-2 focus:ring-green-200 rounded-lg"}),e.jsx(x,{size:"sm",variant:"plain",color:"red",icon:e.jsx($,{}),onClick:()=>c(s,v),className:"hover:bg-red-50 dark:hover:bg-red-900/20 px-3 py-2 rounded-lg",type:"button"})]}),e.jsxs("div",{className:"p-4",children:[o.apartments.length===0&&e.jsx("div",{className:"text-center py-4 text-gray-500 dark:text-gray-400 text-sm bg-white dark:bg-gray-800 rounded mb-4",children:"No apartments in this building"}),e.jsx("div",{className:"space-y-3",children:o.apartments.map((F,M)=>e.jsxs("div",{className:"flex items-center p-3 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-600",children:[e.jsx(ce,{className:"mr-3 text-green-600"}),e.jsx(g,{type:"text",autoComplete:"off",value:F.number,onChange:Y=>X(s,v,M,Y.target.value),placeholder:"Enter apartment number...",component:b,className:"flex-grow mr-4 text-lg py-3 border-2 border-green-200 dark:border-gray-600 focus:border-green-500 focus:ring-2 focus:ring-green-200 rounded-lg"}),e.jsx(x,{size:"sm",variant:"plain",color:"red",icon:e.jsx($,{}),onClick:()=>G(s,v,M),className:"hover:bg-red-50 dark:hover:bg-red-900/20 px-3 py-2 rounded-lg",type:"button"})]},`apartment-${M}`))}),e.jsx(x,{size:"sm",variant:"plain",icon:e.jsx(D,{}),onClick:()=>Q(s,v),className:"mt-3 w-full justify-center bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 py-2 rounded-lg",type:"button",children:"Add Apartment"})]})]},`building-${v}`))}),e.jsx(x,{size:"sm",variant:"plain",icon:e.jsx(D,{}),onClick:()=>j(s),className:"mt-4 w-full justify-center bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 py-2 rounded-lg",type:"button",children:"Add Building"})]})]},`location-${s}`))})]}),e.jsxs(te,{className:"-mx-8 px-8 flex items-center justify-between py-6 mt-8",stickyClass:"border-t bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700",children:[e.jsx(x,{size:"lg",className:"px-6 py-3 text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-xl font-semibold transition-all duration-200",type:"button",onClick:E,icon:e.jsx(oe,{}),children:"Discard"}),e.jsx(x,{size:"lg",variant:"solid",loading:l,disabled:l,icon:e.jsx(ie,{}),type:"submit",className:"px-8 py-3 bg-gradient-to-r from-blue-600 to-indigo-700 hover:from-blue-700 hover:to-indigo-800 text-white font-semibold rounded-xl shadow-lg hover:shadow-xl hover:scale-105 transition-all duration-200",children:O==="edit"?"Update Client":"Create Client"})]})]})})})});J.displayName="ClientForm";const ar=()=>{const y=U(),{id:m}=Z(),[A,O]=C.useState(null),[f,L]=C.useState(!!m);C.useEffect(()=>{m&&(async()=>{try{const n=await _(m);O(n.data),L(!1)}catch{L(!1),R.push(e.jsx(S,{title:"Failed to fetch client data",type:"danger"}),{placement:"top-center"}),y(-1)}})()},[m,y]);const E=async(i,n)=>{n(!0);try{const k=Object.entries(i).reduce((N,[j,c])=>((j==="clientName"||c&&c.trim&&c.trim()!==""||c!=null&&c!=="")&&(N[j]=c),N),{});let w;m?w=await I(m,k):w=await ee(k),w.status===(m?200:201)&&(R.push(e.jsx(S,{title:`Successfully ${m?"updated":"created"} client`,type:"success"}),{placement:"top-center"}),y(-1))}catch{R.push(e.jsx(S,{title:`Failed to ${m?"update":"create"} client`,type:"danger"}),{placement:"top-center"})}finally{n(!1)}},B=()=>{y("/app/client-list")};return f?e.jsx("div",{children:"Loading client data..."}):e.jsx(J,{type:m?"edit":"new",initialData:A||{clientName:"",clientAddress:"",pincode:"",mobileNumber:"",telephoneNumber:"",trnNumber:"",email:"",accountNumber:""},onFormSubmit:E,onDiscard:B})};export{ar as default};
