import{r as u,j as a,m as H}from"./index-cbxZr22l.js";import{C as J}from"./ConfirmDialog-DHHutcW4.js";import{t as I,N as L}from"./toast-BCRt4NsN.js";import{d as Z,c as K,f as Q,h as W,i as X,j as F,k as ee,l as ae,m as te,n as oe}from"./api-D4E9hgI-.js";import"./Alert-CSp5bS7v.js";import"./index-5KOQOspk.js";import"./Badge-DfD0Ukso.js";import{B as se}from"./Button-FHJPdulA.js";import{D as A}from"./index-CpMcTudo.js";import"./Card-RZl4E4-O.js";import"./index-CX5Y9eeL.js";import"./Dialog-OmmgehMy.js";import{D as ne}from"./Drawer-Dn9ylrlH.js";import"./index-BM7LESIb.js";import{a as v}from"./FormItem-Dsb0hqaN.js";import"./useUniqueId-uw_CuIVG.js";import"./Input-CoANB9Wy.js";import"./Upload-DyKyTg7Q.js";import"./index-BLEb6Y8m.js";import"./index-B6FuZSSV.js";import"./ScrollBar-B_8Ws9P0.js";import{S as w}from"./Select-DnpJ3Vfh.js";import"./Tag-DRJajbyJ.js";import{F as le,a as ie,b as D}from"./formik.esm-BL5vnelG.js";import{c as re}from"./index.esm-IKt9PIYR.js";import{d as ce}from"./index-ButNt5UN.js";import{f as _}from"./format-CBpsKyOP.js";import{Z as de}from"./index-DGePi-hy.js";const Oe=({isOpen:f,onClose:p,bill:t,refetch:c,reportType:m})=>{const[s,b]=u.useState(!1);if(console.log(m,"123 reportType inn BillDeleteConfirmation"),!f||!t)return null;const j=()=>{var g,y;switch(t.billType||t.reportType||m){case"general":return`Delete General Bill ${t.invoiceNo?`#${t.invoiceNo}`:""}`;case"fuel":return"Delete Fuel Bill";case"mess":return"Delete Mess Bill";case"vehicle":return`Delete Vehicle Bill ${(g=t.vehicle)!=null&&g.vehicleNumber?`(Vehicle ${t.vehicle.vehicleNumber})`:""}`;case"accommodation":return`Delete Accommodation Bill ${(y=t.accommodation)!=null&&y.location?`(${t.accommodation.location})`:""}`;case"adib":return"Delete Adib Report";case"expense":return"Delete Expense Report";case"profit":return"Delete Profit Report";case"labour":return"Delete Labour Expenses Report";case"payroll":return"Delete Payroll Report";case"visaExpense":return"Delete Visa Expense Report";default:return"Delete Bill"}};console.log(t,"123 bill.billType inn BillDeleteConfirmation");const C=()=>{var g,y;switch(t.billType||t.reportType||m){case"general":return`Are you sure you want to delete this general bill${t.invoiceNo?` (Invoice #${t.invoiceNo})`:""}? This action cannot be undone.`;case"fuel":return"Are you sure you want to delete this fuel bill? This action cannot be undone.";case"mess":return"Are you sure you want to delete this mess bill? This action cannot be undone.";case"vehicle":return`Are you sure you want to delete this vehicle bill${(g=t.vehicle)!=null&&g.vehicleNumber?` for vehicle ${t.vehicle.vehicleNumber}`:""}? This action cannot be undone.`;case"accommodation":return`Are you sure you want to delete this accommodation bill${(y=t.accommodation)!=null&&y.location?` for ${t.accommodation.location}`:""}? This action cannot be undone.`;case"adib":return"Are you sure you want to delete this adib report? This action cannot be undone.";case"expense":return"Are you sure you want to delete this expense report? This action cannot be undone.";case"profit":return"Are you sure you want to delete this profit report? This action cannot be undone.";case"labour":return"Are you sure you want to delete this labour expenses report? This action cannot be undone.";case"payroll":return"Are you sure you want to delete this payroll report? This action cannot be undone.";case"visaExpense":return"Are you sure you want to delete this visa expense report? This action cannot be undone.";default:return"Are you sure you want to delete this bill? This action cannot be undone."}},E=async()=>{var g,y;b(!0);try{await t.billType?Z(t._id):m==="profit"?K(t._id):m==="labour"?Q(t._id):m==="payroll"?W(t._id):m==="visaExpense"?X(t._id):F(t._id),c(),I.push(a.jsx(L,{title:`${j()} deleted successfully`,type:"success",duration:2500,children:t.billType?"The bill has been successfully deleted.":"The report has been successfully deleted."}),{placement:"top-center"}),p()}catch(x){console.error("Delete failed:",x),I.push(a.jsx(L,{title:`Failed to delete ${j()}`,type:"danger",duration:2500,children:((y=(g=x==null?void 0:x.response)==null?void 0:g.data)==null?void 0:y.message)||x.message||"Something went wrong"}),{placement:"top-center"})}finally{b(!1)}};return a.jsxs(J,{isOpen:f,type:"danger",title:j(),confirmButtonColor:"red-600",onClose:p,onRequestClose:p,onCancel:p,onConfirm:E,confirmButtonDisabled:s,children:[a.jsx("p",{children:C()}),s&&a.jsx("div",{className:"mt-4 flex justify-center",children:a.jsx("div",{className:"w-6 h-6 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"})})]})},Te=({isOpen:f,onClose:p,onRequestClose:t,billType:c,onApplyFilters:m,currentFilters:s})=>{const[b,j]=u.useState([]),[C,E]=u.useState([]),[g,y]=u.useState([]),[x,P]=u.useState([]),[O,$]=u.useState(!1),[T,M]=u.useState(!1),[U,B]=u.useState(!1),[Y,R]=u.useState(!1);u.useEffect(()=>{(async()=>{var i,h;try{R(!0);const n=await oe();P(((h=(i=n==null?void 0:n.data)==null?void 0:i.users)==null?void 0:h.map(d=>({label:`${d.firstName} ${d.lastName}`,value:d._id})))||[])}catch(n){console.error("Error loading users:",n)}finally{R(!1)}})()},[]);const N=u.useCallback(async(l="")=>{var i,h;$(!0);try{const n=await ee(l,1,30);j(((h=(i=n==null?void 0:n.data)==null?void 0:i.shops)==null?void 0:h.map(d=>({label:d.shopNo?`${d.shopName} (${d.shopNo})`:d.shopName,value:d._id})))||[])}catch(n){console.error("Error loading shops:",n)}finally{$(!1)}},[]),S=u.useCallback(async(l="")=>{var i,h;M(!0);try{const n=await ae(l,1,30);E(((h=(i=n==null?void 0:n.data)==null?void 0:i.categories)==null?void 0:h.map(d=>({label:d.name,value:d._id})))||[])}catch(n){console.error("Error loading categories:",n)}finally{M(!1)}},[]),V=u.useCallback(async(l="")=>{var i,h;B(!0);try{const n=await te(l,1,30);y(((h=(i=n==null?void 0:n.data)==null?void 0:i.vehicles)==null?void 0:h.map(d=>({label:d.vehicleNumber,value:d._id})))||[])}catch(n){console.error("Error loading vehicles:",n)}finally{B(!1)}},[]);u.useEffect(()=>{f&&(N(),S(),V())},[f,N,S,V]);const k=new Date,q={startDate:(s==null?void 0:s.startDate)||"",endDate:(s==null?void 0:s.endDate)||"",category:(s==null?void 0:s.category)||"",shop:(s==null?void 0:s.shop)||"",vehicleNo:(s==null?void 0:s.vehicleNo)||"",paymentMethod:(s==null?void 0:s.paymentMethod)||"",employee:(s==null?void 0:s.employee)||""},z=l=>{const i={};l.startDate&&(i.startDate=l.startDate),l.endDate&&(i.endDate=l.endDate),l.category&&(i.category=l.category),l.shop&&(i.shop=l.shop),l.vehicleNo&&(i.vehicle=l.vehicleNo),l.paymentMethod&&(i.paymentMethod=l.paymentMethod),l.employee&&(i.employee=l.employee),console.log("Applying Filters from Drawer:",i),m==null||m(i),setTimeout(()=>{p==null||p(new MouseEvent("click"))},100)},G=l=>{l(),m==null||m({startDate:"",endDate:"",category:"",shop:"",vehicle:"",paymentMethod:"",employee:""})};return a.jsx(ne,{title:`Filter ${c.charAt(0).toUpperCase()+c.slice(1)} Bills`,isOpen:f,onClose:p,onRequestClose:t,children:a.jsx(le,{initialValues:q,validationSchema:re({}),onSubmit:z,children:({values:l,errors:i,touched:h,resetForm:n,setFieldValue:d})=>a.jsxs(ie,{className:"space-y-4",children:[a.jsx(v,{label:"Start Date",invalid:!!i.startDate&&h.startDate,children:a.jsx(D,{name:"startDate",children:({field:o,form:r})=>a.jsx(A,{placeholder:"Select Start Date",value:o.value?new Date(o.value):null,maxDate:k,onChange:e=>r.setFieldValue(o.name,e?_(new Date(e.getFullYear(),e.getMonth(),e.getDate()),"yyyy-MM-dd"):"")})})}),a.jsx(v,{label:"End Date",invalid:!!i.endDate&&h.endDate,children:a.jsx(D,{name:"endDate",children:({field:o,form:r})=>a.jsx(A,{placeholder:"Select End Date",value:o.value?new Date(o.value):null,maxDate:k,onChange:e=>r.setFieldValue(o.name,e?_(new Date(e.getFullYear(),e.getMonth(),e.getDate()),"yyyy-MM-dd"):"")})})}),(c==="general"||c==="mess"||c==="accommodation"||c==="vehicle"||c==="adib")&&a.jsx(v,{label:"Shop Name",children:a.jsx(D,{name:"shop",children:({field:o,form:r})=>a.jsx(w,{placeholder:"Select Shop",options:b,value:b.find(e=>e.value===o.value),onChange:e=>r.setFieldValue(o.name,(e==null?void 0:e.value)||""),onInputChange:e=>{N(e)},onClear:()=>{r.setFieldValue(o.name,""),N()},isClearable:!0,loading:O})})}),(c==="general"||c==="adib")&&a.jsx(v,{label:"Category",children:a.jsx(D,{name:"category",children:({field:o,form:r})=>a.jsx(w,{placeholder:"Select Category",options:C,value:C.find(e=>e.value===o.value),onChange:e=>r.setFieldValue(o.name,(e==null?void 0:e.value)||""),onInputChange:e=>{S(e)},onClear:()=>{r.setFieldValue(o.name,""),S()},isClearable:!0,loading:T})})}),(c==="vehicle"||c==="fuel")&&a.jsx(v,{label:"Vehicle No",children:a.jsx(D,{name:"vehicleNo",children:({field:o,form:r})=>a.jsx(w,{placeholder:"Select Vehicle",options:g,value:g.find(e=>e.value===o.value),onChange:e=>r.setFieldValue(o.name,(e==null?void 0:e.value)||""),onInputChange:e=>{V(e)},onClear:()=>{r.setFieldValue(o.name,""),V()},isClearable:!0,loading:U})})}),["general","mess","fuel","vehicle","accommodation"].includes(c)&&a.jsx(v,{label:"Payment Method",children:a.jsx(D,{name:"paymentMethod",children:({field:o,form:r})=>a.jsx(w,{placeholder:"Select Payment Method",options:paymentMethodOptions,value:paymentMethodOptions.find(e=>e.value===o.value),onChange:e=>r.setFieldValue(o.name,(e==null?void 0:e.value)||""),onClear:()=>r.setFieldValue(o.name,""),isClearable:!0})})}),(c==="visaExpense"||c==="labour"||c==="payroll")&&a.jsx(v,{label:"Employee",children:a.jsx(D,{name:"employee",children:({field:o,form:r})=>a.jsx(w,{placeholder:"Select Employee",options:x,value:x.find(e=>e.value===o.value),onChange:e=>r.setFieldValue(o.name,(e==null?void 0:e.value)||""),onClear:()=>r.setFieldValue(o.name,""),isClearable:!0,loading:Y})})}),a.jsxs("div",{className:"mt-8 flex justify-end gap-2",children:[a.jsxs("button",{type:"button",onClick:()=>G(n),className:"flex items-center gap-1 text-sm bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-white px-3 py-1.5 rounded hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors",children:[a.jsx(ce,{className:"text-base"}),"Reset"]}),a.jsx("button",{type:"submit",className:"text-sm bg-blue-600 text-white px-3 py-1.5 rounded hover:bg-blue-700 transition-colors",children:"Apply Filters"})]})]})},`${f}-${JSON.stringify(s)}`)})},Ue=({to:f,title:p})=>a.jsx("div",{className:"flex flex-col lg:flex-row lg:items-center gap-2",children:a.jsx(H,{className:"block lg:inline-block md:mb-0 mb-4",to:f,children:a.jsx(se,{block:!0,variant:"solid",size:"sm",icon:a.jsx(de,{}),children:p})})});export{Ue as B,Oe as a,Te as b};
