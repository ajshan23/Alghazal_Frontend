import{r as f,j as e,b as s,v as R,a8 as F}from"./index-cbxZr22l.js";import{t as b,N as j}from"./toast-BCRt4NsN.js";import{F as O,a as A,b as x}from"./formik.esm-BL5vnelG.js";import{c as $,b as v,g as N,f as M,d as z}from"./index.esm-IKt9PIYR.js";import"./Alert-CSp5bS7v.js";import"./index-5KOQOspk.js";import"./Badge-DfD0Ukso.js";import{B as C}from"./Button-FHJPdulA.js";import{D as E}from"./index-CpMcTudo.js";import"./Card-RZl4E4-O.js";import"./index-CX5Y9eeL.js";import"./Dialog-OmmgehMy.js";import"./Drawer-Dn9ylrlH.js";import"./index-BM7LESIb.js";import{F as P,a as d}from"./FormItem-Dsb0hqaN.js";import"./useUniqueId-uw_CuIVG.js";import{I as y}from"./Input-CoANB9Wy.js";import{R as k}from"./Upload-DyKyTg7Q.js";import"./index-BLEb6Y8m.js";import"./index-B6FuZSSV.js";import"./ScrollBar-B_8Ws9P0.js";import{S as q}from"./Select-DnpJ3Vfh.js";import"./Tag-DRJajbyJ.js";import{S as L}from"./StickyFooter-CtESxEiE.js";import{A as U}from"./index-Y8XfetB3.js";import{_}from"./index-DGePi-hy.js";import{C as G}from"./ConfirmDialog-DHHutcW4.js";import{A as B}from"./AdaptableCard-CZjN_iCO.js";import"./Views-B4cM7RDw.js";import"./SvgIcon-Bm8Tzw9S.js";import"./DataTable-C4s3mb93.js";import{a as H,e as Z,b as J}from"./api-BId_EcBn.js";import"./StatusIcon-CfTAV1XC.js";import"./CloseButton-BgX1UjTO.js";import"./chainedFunction-BxZSneMW.js";import"./proxy-CCW0hh_w.js";import"./cloneDeep-DJN0yfLA.js";import"./hoist-non-react-statics.cjs-85N_kEkV.js";import"./floating-ui.react-CXyQfini.js";import"./floating-ui.dom-B_iSk-nO.js";import"./index-pMPtRiQM.js";import"./context-Ci1lPV1_.js";import"./_getPrototype-DErBkxwa.js";import"./index-DdVDk-x0.js";import"./index-BUmdAIPo.js";import"./toString-DDHIFlh6.js";import"./index-C8fXiORa.js";import"./defineProperty-DRmM3rRU.js";import"./typeof-QjJsDpFa.js";import"./useThemeClass-C-wX5hDk.js";const T=[{value:"car",label:"Car"},{value:"truck",label:"Truck"},{value:"van",label:"Van"},{value:"pickup",label:"Pickup"},{value:"motorcycle",label:"Motorcycle"},{value:"other",label:"Other"}],K=[{value:"active",label:"Active"},{value:"inactive",label:"Inactive"},{value:"maintenance",label:"Maintenance"}],w=new Date().getFullYear(),V=Array.from({length:30},(c,i)=>({value:w-i,label:(w-i).toString()})),I=f.forwardRef((c,i)=>{const{type:p,initialData:o={vehicleNumber:"",vehicleType:"car",make:"",model:"",year:null,color:"",registrationDate:new Date,insuranceExpiry:new Date,lastServiceDate:void 0,currentMileage:0,status:"active"},onFormSubmit:h,onDiscard:g,onDelete:D}=c,S=$().shape({vehicleNumber:v().required("Vehicle number is required").matches(/^[A-Z0-9]+$/,"Must be uppercase alphanumeric"),vehicleType:v().required("Vehicle type is required"),make:v().required("Make is required"),model:v().required("Model is required"),year:N().required("Year is required").min(1900,"Year must be after 1900").max(w+1,"Year can't be in the future"),color:v(),registrationDate:M().required("Registration date is required"),insuranceExpiry:M().required("Insurance expiry is required").min(z("registrationDate"),"Insurance expiry must be after registration date"),lastServiceDate:M().nullable(),currentMileage:N().min(0,"Mileage cannot be negative").integer("Mileage must be a whole number"),status:v().required("Status is required")});return e.jsx(O,{innerRef:i,initialValues:{...o,year:o.year||null,registrationDate:o.registrationDate?s(o.registrationDate).toDate():new Date,insuranceExpiry:o.insuranceExpiry?s(o.insuranceExpiry).toDate():new Date,lastServiceDate:o.lastServiceDate?s(o.lastServiceDate).toDate():void 0},validationSchema:S,onSubmit:async(r,{setSubmitting:a,setErrors:n})=>{try{if(!r.vehicleNumber||!r.vehicleType||!r.make||!r.model||!r.year||!r.registrationDate||!r.insuranceExpiry)throw new Error("Required fields are missing");const u={...r,registrationDate:s(r.registrationDate).format("YYYY-MM-DD"),insuranceExpiry:s(r.insuranceExpiry).format("YYYY-MM-DD"),lastServiceDate:r.lastServiceDate?s(r.lastServiceDate).format("YYYY-MM-DD"):void 0};await h(u,a)}catch(u){a(!1),b.push(e.jsx(j,{title:"Validation Error",type:"danger",duration:2500,children:u.message||"Please fill all required fields"}),{placement:"top-center"})}},enableReinitialize:!0,validateOnChange:!0,validateOnBlur:!0,children:({values:r,errors:a,touched:n,isSubmitting:u,setFieldValue:m})=>e.jsx(A,{children:e.jsxs(P,{children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsxs(B,{divider:!0,className:"mb-4",children:[e.jsx("h5",{className:"mb-4",children:"Vehicle Information"}),e.jsx(d,{label:"Vehicle Number",invalid:!!(a.vehicleNumber&&n.vehicleNumber),errorMessage:a.vehicleNumber,children:e.jsx(x,{type:"text",autoComplete:"off",name:"vehicleNumber",placeholder:"Enter vehicle number",component:y,onChange:t=>{m("vehicleNumber",t.target.value.toUpperCase())}})}),e.jsx(d,{label:"Vehicle Type",invalid:!!(a.vehicleType&&n.vehicleType),errorMessage:a.vehicleType,children:e.jsx(q,{placeholder:"Select vehicle type",field:"vehicleType",options:T,value:T.find(t=>t.value===r.vehicleType),onChange:t=>m("vehicleType",t==null?void 0:t.value)})}),e.jsx(d,{label:"Make",invalid:!!(a.make&&n.make),errorMessage:a.make,children:e.jsx(x,{type:"text",autoComplete:"off",name:"make",placeholder:"Enter make",component:y})}),e.jsx(d,{label:"Model",invalid:!!(a.model&&n.model),errorMessage:a.model,children:e.jsx(x,{type:"text",autoComplete:"off",name:"model",placeholder:"Enter model",component:y})}),e.jsx(d,{label:"Year",invalid:!!(a.year&&n.year),errorMessage:a.year,children:e.jsx(q,{placeholder:"Select year",field:"year",options:V,value:r.year?V.find(t=>t.value===r.year):void 0,onChange:t=>m("year",t==null?void 0:t.value)})}),e.jsx(d,{label:"Color",invalid:!!(a.color&&n.color),errorMessage:a.color,children:e.jsx(x,{type:"text",autoComplete:"off",name:"color",placeholder:"Enter color",component:y})})]}),e.jsxs(B,{divider:!0,className:"mb-4",children:[e.jsx("h5",{className:"mb-4",children:"Registration & Status"}),e.jsx(d,{label:"Registration Date",invalid:!!(a.registrationDate&&n.registrationDate),errorMessage:a.registrationDate,children:e.jsx(E,{field:"registrationDate",placeholder:"Select registration date",value:r.registrationDate,onChange:t=>{t&&(m("registrationDate",t),r.insuranceExpiry&&s(t).isAfter(r.insuranceExpiry)&&m("insuranceExpiry",t))},maxDate:new Date})}),e.jsx(d,{label:"Insurance Expiry Date",invalid:!!(a.insuranceExpiry&&n.insuranceExpiry),errorMessage:a.insuranceExpiry,children:e.jsx(E,{field:"insuranceExpiry",placeholder:"Select insurance expiry date",value:r.insuranceExpiry,onChange:t=>{t&&m("insuranceExpiry",t)},minDate:r.registrationDate})}),e.jsx(d,{label:"Last Service Date",invalid:!!(a.lastServiceDate&&n.lastServiceDate),errorMessage:a.lastServiceDate,children:e.jsx(E,{field:"lastServiceDate",placeholder:"Select last service date",value:r.lastServiceDate,onChange:t=>{t&&m("lastServiceDate",t)},maxDate:new Date})}),e.jsx(d,{label:"Current Mileage (km)",invalid:!!(a.currentMileage&&n.currentMileage),errorMessage:a.currentMileage,children:e.jsx(x,{type:"number",autoComplete:"off",name:"currentMileage",placeholder:"Enter current mileage",component:y,min:0})}),e.jsx(d,{label:"Status",invalid:!!(a.status&&n.status),errorMessage:a.status,children:e.jsx(k.Group,{value:r.status,onChange:t=>m("status",t),children:K.map(t=>e.jsx(k,{value:t.value,children:t.label},t.value))})})]})]}),e.jsxs(L,{className:"-mx-8 px-8 flex items-center justify-between py-4",stickyClass:"border-t bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700",children:[e.jsx("div",{children:p==="edit"&&D&&e.jsx(Q,{onDelete:D})}),e.jsxs("div",{className:"md:flex items-center",children:[e.jsx(C,{size:"sm",className:"ltr:mr-3 rtl:ml-3",type:"button",onClick:()=>g==null?void 0:g(),children:"Discard"}),e.jsx(C,{size:"sm",variant:"solid",loading:u,icon:e.jsx(U,{}),type:"submit",children:"Save"})]})]})]})})})});I.displayName="VehicleForm";const Q=({onDelete:c})=>{const[i,p]=f.useState(!1),o=()=>{p(!1),c==null||c(p)},h=()=>{p(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(C,{className:"text-red-600",variant:"plain",size:"sm",icon:e.jsx(_,{}),type:"button",onClick:()=>p(!0),children:"Delete"}),e.jsxs(G,{isOpen:i,type:"danger",title:"Delete Vehicle",confirmButtonColor:"red-600",onClose:h,onRequestClose:h,onCancel:h,onConfirm:o,children:[e.jsx("p",{children:"Are you sure you want to delete this vehicle?"}),e.jsx("p",{className:"mt-2 text-sm text-gray-600 dark:text-gray-400",children:"This action cannot be undone."})]})]})},W={vehicleNumber:"",vehicleType:"car",make:"",model:"",year:new Date().getFullYear(),color:"",registrationDate:new Date,insuranceExpiry:new Date,lastServiceDate:void 0,currentMileage:0,status:"active"},Je=()=>{const c=R(),{id:i}=F(),[p,o]=f.useState(W),[h,g]=f.useState(!!i);f.useEffect(()=>{i&&(async()=>{try{const a=await H(i);if(!a||!a.data)throw new Error("Invalid vehicle data");const n={...a.data,registrationDate:s(a.data.registrationDate).toDate(),insuranceExpiry:s(a.data.insuranceExpiry).toDate(),lastServiceDate:a.data.lastServiceDate?s(a.data.lastServiceDate).toDate():void 0};o(n),g(!1)}catch(a){console.error("Error fetching vehicle:",a),g(!1),b.push(e.jsx(j,{title:"Failed to fetch vehicle data",type:"danger",duration:2500,children:a.message||"Something went wrong"}),{placement:"top-center"}),c("/app/vehicles")}})()},[i,c]);const D=async(r,a)=>{var n,u,m,t;a(!0);try{let l;const Y={...r,registrationDate:s(r.registrationDate).format("YYYY-MM-DD"),insuranceExpiry:s(r.insuranceExpiry).format("YYYY-MM-DD"),lastServiceDate:r.lastServiceDate?s(r.lastServiceDate).format("YYYY-MM-DD"):void 0};if(i?l=await Z(i,Y):l=await J(Y),l.statusCode===200||l.statusCode===201)a(!1),b.push(e.jsxs(j,{title:`Successfully ${i?"updated":"added"} vehicle`,type:"success",duration:2500,children:["Vehicle ",i?"updated":"added"," successfully"]}),{placement:"top-center"}),c("/app/vehicle-view");else throw new Error(((u=(n=l==null?void 0:l.response)==null?void 0:n.data)==null?void 0:u.message)||"Unexpected status code")}catch(l){console.error("Error during form submission:",l),a(!1),b.push(e.jsx(j,{title:`Error ${i?"updating":"adding"} vehicle`,type:"danger",duration:2500,children:((t=(m=l==null?void 0:l.response)==null?void 0:m.data)==null?void 0:t.message)||l.message}),{placement:"top-center"})}},S=()=>{c("/app/vehicles")};return h?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):e.jsx(I,{type:i?"edit":"new",initialData:p,onFormSubmit:D,onDiscard:S})};export{Je as default};
