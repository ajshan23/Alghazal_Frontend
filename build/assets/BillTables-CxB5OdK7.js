import{A as D,F as oe,r as m,j as o,b as S,v as re}from"./index-DGJe0h3_.js";import{D as se}from"./DataTable-CLMBeNRf.js";import{P as le,b9 as ne,N as ie,V as ce,_ as de}from"./index-DB0cxP-C.js";import{u as he}from"./useThemeClass-CWxsYH8M.js";import{u as pe}from"./useQuery-D-uGNTqp.js";import{d as me}from"./debounce-BytNY59r.js";import{I as ue}from"./Input-k-NORbeb.js";import{B as ge}from"./Badge-Bbo5QMXa.js";import{e as ve,b as ye}from"./api-BtuCWMnW.js";import{h as xe}from"./moment-C5S46NFB.js";import{a as be,b as fe}from"./BillTableTools-CSJkZP-A.js";import{c as Ne}from"./index-C8abeZB5.js";var k={exports:{}},je=k.exports,L;function we(){return L||(L=1,function(x,w){(function(v,u){u()})(je,function(){function v(s,r){return typeof r>"u"?r={autoBom:!1}:typeof r!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),r={autoBom:!r}),r.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(s.type)?new Blob(["\uFEFF",s],{type:s.type}):s}function u(s,r,d){var l=new XMLHttpRequest;l.open("GET",s),l.responseType="blob",l.onload=function(){p(l.response,r,d)},l.onerror=function(){console.error("could not download file")},l.send()}function b(s){var r=new XMLHttpRequest;r.open("HEAD",s,!1);try{r.send()}catch{}return 200<=r.status&&299>=r.status}function y(s){try{s.dispatchEvent(new MouseEvent("click"))}catch{var r=document.createEvent("MouseEvents");r.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),s.dispatchEvent(r)}}var h=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof D=="object"&&D.global===D?D:void 0,f=h.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),p=h.saveAs||(typeof window!="object"||window!==h?function(){}:"download"in HTMLAnchorElement.prototype&&!f?function(s,r,d){var l=h.URL||h.webkitURL,c=document.createElement("a");r=r||s.name||"download",c.download=r,c.rel="noopener",typeof s=="string"?(c.href=s,c.origin===location.origin?y(c):b(c.href)?u(s,r,d):y(c,c.target="_blank")):(c.href=l.createObjectURL(s),setTimeout(function(){l.revokeObjectURL(c.href)},4e4),setTimeout(function(){y(c)},0))}:"msSaveOrOpenBlob"in navigator?function(s,r,d){if(r=r||s.name||"download",typeof s!="string")navigator.msSaveOrOpenBlob(v(s,d),r);else if(b(s))u(s,r,d);else{var l=document.createElement("a");l.href=s,l.target="_blank",setTimeout(function(){y(l)})}}:function(s,r,d,l){if(l=l||open("","_blank"),l&&(l.document.title=l.document.body.innerText="downloading..."),typeof s=="string")return u(s,r,d);var c=s.type==="application/octet-stream",E=/constructor/i.test(h.HTMLElement)||h.safari,A=/CriOS\/[\d]+/.test(navigator.userAgent);if((A||c&&E||f)&&typeof FileReader<"u"){var N=new FileReader;N.onloadend=function(){var n=N.result;n=A?n:n.replace(/^data:[^;]*;/,"data:attachment/file;"),l?l.location.href=n:location=n,l=null},N.readAsDataURL(s)}else{var j=h.URL||h.webkitURL,C=j.createObjectURL(s);l?l.location=C:location.href=C,l=null,setTimeout(function(){j.revokeObjectURL(C)},4e4)}});h.saveAs=p.saveAs=p,x.exports=p})}(k)),k.exports}var Ae=we();const H={adcb_card:{label:"ADCB CARD",dotClass:"bg-blue-500",textClass:"text-blue-500"},adcb_bank:{label:"ADCB BANK",dotClass:"bg-blue-600",textClass:"text-blue-600"},mashreq_bank:{label:"MASHREQ BANK",dotClass:"bg-orange-600",textClass:"text-orange-600"},mashreq_card:{label:"MASHREQ CARD",dotClass:"bg-orange-500",textClass:"text-orange-500"},adib:{label:"ADIB",dotClass:"bg-green-500",textClass:"text-green-500"},owner_personal_pay:{label:"OWNER PERSONAL PAY",dotClass:"bg-teal-500",textClass:"text-teal-500"},mr_syed_pay:{label:"MR.SYED PAY",dotClass:"bg-pink-500",textClass:"text-pink-500"},other_pay:{label:"OTHER PAY",dotClass:"bg-yellow-600",textClass:"text-yellow-600"},credit:{label:"CREDIT",dotClass:"bg-indigo-500",textClass:"text-indigo-500"},cash:{label:"CASH",dotClass:"bg-purple-500",textClass:"text-purple-500"},cheque:{label:"CHEQUE",dotClass:"bg-gray-600",textClass:"text-gray-600"},wio_card:{label:"WIO CARD",dotClass:"bg-red-500",textClass:"text-red-500"},wio_bank:{label:"WIO BANK",dotClass:"bg-red-600",textClass:"text-red-600"}},R=[{value:1,label:"January"},{value:2,label:"February"},{value:3,label:"March"},{value:4,label:"April"},{value:5,label:"May"},{value:6,label:"June"},{value:7,label:"July"},{value:8,label:"August"},{value:9,label:"September"},{value:10,label:"October"},{value:11,label:"November"},{value:12,label:"December"}],Ce=Array.from({length:10},(x,w)=>({value:S().year()-5+w,label:(S().year()-5+w).toString()})),He=({onDropdownSelect:x})=>{var _,B,T;const v=oe().pathname,[u,b]=m.useState(!1),y=m.useRef(null),[h,f]=m.useState(""),[p,s]=m.useState({page:1,limit:10}),[r,d]=m.useState({startDate:"",endDate:"",category:"",shop:"",vehicleNo:"",paymentMethod:"",month:new Date().getMonth()+1,year:new Date().getFullYear()}),[l,c]=m.useState(!1),[E,A]=m.useState(null),[N,j]=m.useState(!1),n=v.includes("/fuel-bill-view")?"fuel":v.includes("/mess-bill-view")?"mess":v.includes("/vehicle-bill-view")?"vehicle":v.includes("/acc-bill-view")?"accommodation":v.includes("/commission-bill-view")?"commission":"general",Y=e=>{console.log("New filters from drawer:",e);const a={...r};e.startDate!==void 0&&(a.startDate=e.startDate),e.endDate!==void 0&&(a.endDate=e.endDate),e.category!==void 0&&(a.category=e.category),e.shop!==void 0&&(a.shop=e.shop),e.vehicle!==void 0&&(a.vehicleNo=e.vehicle),e.paymentMethod!==void 0&&(a.paymentMethod=e.paymentMethod),e.employee!==void 0&&(a.employee=e.employee),(e.startDate||e.endDate)&&(a.month="",a.year=""),console.log("Updated filters state:",a),d(a),s(t=>({...t,page:1}))},{data:g,isLoading:F,error:K,refetch:I}=pe({queryKey:["bills",p.page,p.limit,h,r,n],queryFn:()=>ye({page:p.page,limit:p.limit,billType:n,search:h,month:r.startDate||r.endDate?void 0:r.month,year:r.startDate||r.endDate?void 0:r.year,startDate:r.startDate,endDate:r.endDate,category:r.category,shop:r.shop,vehicle:r.vehicleNo,paymentMethod:r.paymentMethod})}),U=((_=g==null?void 0:g.data)==null?void 0:_.bills)||[],P=((B=g==null?void 0:g.data)==null?void 0:B.totalAmount)||0,M=((T=g==null?void 0:g.data)==null?void 0:T.pagination)||{total:0,page:1,limit:10},$=m.useMemo(()=>me(e=>{f(e),s(a=>({...a,page:1}))},500),[]),q=e=>{$(e.target.value)},z=({row:e,onDeleteClick:a})=>{const{textTheme:t}=he(),i=re(),te={general:"/app/new-gen-bill",mess:"/app/new-mess-bill",fuel:"/app/new-fuel-bill",vehicle:"/app/new-vehicle-bill",accommodation:"/app/new-acc-bill",commission:"/app/new-commission-bill"};return o.jsxs("div",{className:"flex text-lg",children:[o.jsx("span",{className:`cursor-pointer p-2 hover:${t}`,onClick:()=>i("/app/bill-attachments",{state:{data:e==null?void 0:e.attachments}}),children:o.jsx(ie,{})}),o.jsx("span",{className:`cursor-pointer p-2 hover:${t}`,onClick:()=>i(`${te[n]}/${e._id}`),children:o.jsx(ce,{})}),o.jsx("span",{className:"cursor-pointer p-2 hover:text-red-500",onClick:()=>a(e),children:o.jsx(de,{})})]})},Q=()=>{const e=[{header:"S.NO",accessorKey:"_id",cell:a=>o.jsx("span",{children:a.row.index+1})},{header:"DATE",accessorKey:"billDate",cell:a=>o.jsx("span",{children:xe(a.row.original.billDate).format("DD MMM YYYY")})},{header:"Payment Method",accessorKey:"paymentMethod",cell:a=>{const t=a.row.original.paymentMethod,i=H[t]||{label:t,dotClass:"bg-gray-500",textClass:"text-gray-500"};return o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx(ge,{className:i.dotClass}),o.jsx("span",{className:`capitalize font-semibold ${i.textClass}`,children:i.label})]})}},{header:"Amount",accessorKey:"amount",cell:a=>o.jsxs("span",{children:[" ",a.row.original.amount.toFixed(2)]})},{header:"Action",id:"action",cell:a=>o.jsx(z,{row:a.row.original,onDeleteClick:t=>{A(t),c(!0)}})}];return n==="mess"?[e[0],e[1],{header:"Shop Name",accessorKey:"shop",cell:a=>{var t;return o.jsx("span",{children:((t=a.row.original.shop)==null?void 0:t.shopName)||"N/A"})}},{header:"Shop Number",accessorKey:"shopNo",cell:a=>{var t;return o.jsx("span",{children:((t=a.row.original.shop)==null?void 0:t.shopNo)||"N/A"})}},{header:"Invoice No",accessorKey:"invoiceNo",cell:a=>o.jsx("span",{children:a.row.original.invoiceNo||"N/A"})},e[2],e[3],e[4]]:n==="general"?[e[0],e[1],{header:"Category",accessorKey:"category",cell:a=>{var t;return o.jsx("span",{children:((t=a.row.original.category)==null?void 0:t.name)||"N/A"})}},{header:"Shop Name",accessorKey:"shop",cell:a=>{var t;return o.jsx("span",{children:((t=a.row.original.shop)==null?void 0:t.shopName)||"N/A"})}},{header:"Shop Number",accessorKey:"shopNo",cell:a=>{var t;return o.jsx("span",{children:((t=a.row.original.shop)==null?void 0:t.shopNo)||"N/A"})}},{header:"Invoice No",accessorKey:"invoiceNo",cell:a=>o.jsx("span",{children:a.row.original.invoiceNo||"N/A"})},e[2],e[3],{header:"REMARK",accessorKey:"remarks",cell:a=>o.jsx("span",{children:a.row.original.remarks||"N/A"})},e[4]]:n==="fuel"?[e[0],e[1],{header:"Description",accessorKey:"remarks",cell:a=>o.jsx("span",{children:a.row.original.remarks||"N/A"})},{header:"Vehicle No",accessorKey:"vehicle",cell:a=>{const t=a.row.original;return t.vehicles&&Array.isArray(t.vehicles)&&t.vehicles.length>0?o.jsx("span",{children:t.vehicles.map(i=>i.vehicleNumber).join(", ")}):t.vehicle&&t.vehicle.vehicleNumber?o.jsx("span",{children:t.vehicle.vehicleNumber}):o.jsx("span",{children:"N/A"})}},e[2],e[3],{header:"Kilometer",accessorKey:"kilometer",cell:a=>{var t;return o.jsx("span",{children:((t=a.row.original.kilometer)==null?void 0:t.toFixed(2))||"N/A"})}},{header:"Liter",accessorKey:"liter",cell:a=>{var t;return o.jsx("span",{children:((t=a.row.original.liter)==null?void 0:t.toFixed(2))||"N/A"})}},{header:"Remarks",accessorKey:"remarks",cell:a=>o.jsx("span",{children:a.row.original.remarks||"N/A"})},e[4]]:n==="vehicle"?[e[0],e[1],{header:"Purpose Of Use",accessorKey:"remarks",cell:a=>o.jsx("span",{children:a.row.original.purpose||"N/A"})},{header:"Vehicle No",accessorKey:"vehicle",cell:a=>{const t=a.row.original;return t.vehicles&&Array.isArray(t.vehicles)&&t.vehicles.length>0?o.jsx("span",{children:t.vehicles.map(i=>i.vehicleNumber).join(", ")}):t.vehicle&&t.vehicle.vehicleNumber?o.jsx("span",{children:t.vehicle.vehicleNumber}):o.jsx("span",{children:"N/A"})}},{header:"Invoice No",accessorKey:"invoiceNo",cell:a=>o.jsx("span",{children:a.row.original.invoiceNo||"N/A"})},e[2],e[3],{header:"Shop Name",accessorKey:"shop",cell:a=>{var t;return o.jsx("span",{children:((t=a.row.original.shop)==null?void 0:t.shopName)||"N/A"})}},{header:"Remarks",accessorKey:"remarks",cell:a=>o.jsx("span",{children:a.row.original.remarks||"N/A"})},e[4]]:n==="accommodation"?[e[0],e[1],{header:"Company Name",accessorKey:"shop",cell:a=>{var t;return o.jsx("span",{children:((t=a.row.original.shop)==null?void 0:t.shopName)||"N/A"})}},{header:"Room No",accessorKey:"accommodation",cell:a=>{var t;return o.jsx("span",{children:((t=a.row.original)==null?void 0:t.roomNo)||"N/A"})}},{header:"Invoice No",accessorKey:"invoiceNo",cell:a=>o.jsx("span",{children:a.row.original.invoiceNo||"N/A"})},{header:"Payment Mode",accessorKey:"paymentMethod",cell:a=>{const t=a.row.original.paymentMethod,i=H[t]||{label:t,textClass:"text-gray-500"};return o.jsx("span",{className:`capitalize font-semibold ${i.textClass}`,children:i.label})}},e[3],{header:"Note",accessorKey:"remarks",cell:a=>o.jsx("span",{children:a.row.original.remarks||"N/A"})},{header:"Remarks",accessorKey:"remarks",cell:a=>o.jsx("span",{children:a.row.original.remarks||"N/A"})},e[4]]:n==="commission"?[e[0],e[1],e[3],{header:"REMARK",accessorKey:"remarks",cell:a=>o.jsx("span",{children:a.row.original.remarks||"N/A"})},e[4]]:e},W=m.useMemo(()=>Q(),[n]),J=e=>{s(a=>({...a,page:e}))},V=e=>{s(a=>({page:1,limit:e}))},G=()=>{j(!0)},O=e=>{console.log("onDrawerClose",e),j(!1)},X=()=>{var e,a;d({startDate:"",endDate:"",category:"",shop:"",vehicleNo:"",paymentMethod:"",month:new Date().getMonth()+1,year:new Date().getFullYear()}),f(""),s({page:1,limit:10}),(a=(e=y.current)==null?void 0:e.resetSorting)==null||a.call(e)},Z=e=>{var t;const a=((t=R.find(i=>i.value===e))==null?void 0:t.label)||"";d(i=>({...i,month:e})),x(a),s(i=>({...i,page:1}))},ee=e=>{d(a=>({...a,year:e})),s(a=>({...a,page:1}))},ae=async()=>{b(!0);try{const e=await ve({page:p.page,limit:p.limit,search:h,billType:n,month:r.startDate||r.endDate?void 0:r.month,year:r.startDate||r.endDate?void 0:r.year,startDate:r.startDate,endDate:r.endDate,category:r.category,shop:r.shop,vehicle:r.vehicleNo,paymentMethod:r.paymentMethod}),a=`bills_${n}_${S().format("YYYY-MM-DD")}.xlsx`;Ae.saveAs(e,a),console.log("Export completed successfully")}catch(e){console.error("Error exporting bills:",e),alert(`Export failed: ${e.message||"Unknown error occurred"}`)}finally{b(!1)}};return m.useEffect(()=>{var a;const e=((a=R.find(t=>t.value===r.month))==null?void 0:a.label)||"";x(e)},[r.month,x]),K?o.jsxs("div",{children:["Error loading bills: ",K.message]}):o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"mb-4 flex flex-col md:flex-row gap-4 justify-between items-center",children:[n!=="commission"&&o.jsx(ue,{placeholder:"Search bills...",onChange:q,className:"max-w-md w-full md:w-auto"}),o.jsxs("div",{className:"flex gap-2 items-center",children:[o.jsx("select",{className:"p-2 border rounded-md dark:bg-gray-800 dark:border-gray-700",value:r.month,onChange:e=>Z(Number(e.target.value)),children:R.map(e=>o.jsx("option",{value:e.value,children:e.label},e.value))}),o.jsx("select",{className:"p-2 border rounded-md dark:bg-gray-800 dark:border-gray-700",value:r.year,onChange:e=>ee(Number(e.target.value)),children:Ce.map(e=>o.jsx("option",{value:e.value,children:e.label},e.value))}),o.jsx("button",{onClick:X,className:"p-2 text-gray-500 hover:text-gray-700 dark:hover:text-gray-300",title:"Reset filters",children:o.jsx(le,{size:18})}),o.jsx("button",{onClick:ae,disabled:u,className:`p-2 ${u?"text-gray-400":"text-gray-500 hover:text-gray-700 dark:hover:text-gray-300"}`,title:u?"Exporting...":"Export bills",children:o.jsx(ne,{size:18})}),o.jsxs("button",{onClick:()=>G(),className:"px-4 py-2 flex items-center gap-2 bg-gray-100 dark:bg-gray-700 rounded-md border border-gray-200 dark:border-gray-600 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors",children:[o.jsx(Ne,{size:16}),"Filter"]})]})]}),o.jsx(se,{ref:y,columns:W,data:U,totalAmount:P,loading:F,pagingData:{total:M.total,pageIndex:M.page,pageSize:M.limit},onPaginationChange:J,onSelectChange:V}),o.jsx(be,{isOpen:l,onClose:()=>c(!1),bill:E,refetch:I}),o.jsx(fe,{isOpen:N,billType:n,onClose:O,onRequestClose:O,onApplyFilters:Y,currentFilters:r})]})};export{He as B};
