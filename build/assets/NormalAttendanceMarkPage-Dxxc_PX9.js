import{r as s,b as n,j as e,T as _}from"./index-BqYC2zCO.js";import"./Alert-Praf8Fi9.js";import{A as B}from"./index-BhxlP8yV.js";import{B as w}from"./Badge-CrbEpOhk.js";import{B as o}from"./Button-BZH25-Aw.js";import"./index-Bm5J6gtn.js";import{C as E}from"./Card-DiA6JKLe.js";import"./index-o6PoulbO.js";import"./Dialog-C85wTnEL.js";import"./Drawer-3BaRt1RV.js";import"./index-BNWCw_o_.js";import"./FormItem-FeS_vrRF.js";import"./useUniqueId-BmsTzdR7.js";import"./Input-CF7OdvAt.js";import"./Upload-B1V-WMlx.js";import"./index-fwAOcRNC.js";import{t as d,N as c}from"./toast-BNCR3rph.js";import"./index-BkSrbwb3.js";import"./ScrollBar-bvGQZvnP.js";import"./Select-3fyDv9Rf.js";import"./Tag-DOC98LxQ.js";import{H,ay as z,P}from"./index-CErL3g3x.js";import{b as R,c as T}from"./api-CFLnU45Y.js";import{u as F}from"./useThemeClass-CB8d6Ww5.js";import"./Views-B3egHxO-.js";import"./SvgIcon-C9XuCCBp.js";import"./DataTable-CIH-lnfj.js";import{F as L}from"./index-BdZOEYLW.js";import{M as O}from"./MarkAttendanceModal-DaKf_bDp.js";import"./StatusIcon-CrxJz663.js";import"./CloseButton-L6WjsDsk.js";import"./proxy-DBs-aCG0.js";import"./floating-ui.react-DBGHfBho.js";import"./floating-ui.dom-B_iSk-nO.js";import"./index-BLbmKy6n.js";import"./context-CKHslMnf.js";import"./_getPrototype-_N1fRqzo.js";import"./index-Z1Egzvm9.js";import"./index-DtRKDKi1.js";import"./toString-sucKyfO-.js";import"./chainedFunction-BxZSneMW.js";import"./index-BnTamqJo.js";import"./defineProperty-DRmM3rRU.js";import"./typeof-QjJsDpFa.js";import"./hoist-non-react-statics.cjs-7CwaeXnJ.js";import"./cloneDeep-DJN0yfLA.js";const He=()=>{F();const[b,l]=s.useState(!0),[m,p]=s.useState(!1),[x,h]=s.useState([]),[M,A]=s.useState(n().format("DD MMM YYYY")),[Y,u]=s.useState(!1),[f,g]=s.useState(null),[y,C]=s.useState("present"),j=async()=>{try{l(!0);const t=n().format("YYYY-MM-DD"),a=await R(t);a.data&&a.data.data&&(h(a.data.data.users||[]),A(n(a.data.data.date).format("DD MMM YYYY")))}catch(t){d.push(e.jsx(c,{title:"Error fetching attendance",type:"danger",children:t.message}))}finally{l(!1)}};s.useEffect(()=>{j()},[]);const N=async(t,a,v)=>{try{p(!0),await T({userId:t,present:a,hour:a?v:0}),h(r=>r.map(i=>i.user._id===t?{...i,present:a,workingHours:a?v:0,markedBy:{_id:"current-user",firstName:"You",lastName:""},markedAt:new Date}:i)),d.push(e.jsx(c,{title:"Success",type:"success",children:"Attendance marked successfully"}))}catch(r){d.push(e.jsx(c,{title:"Error marking attendance",type:"danger",children:r.message}))}finally{p(!1)}},D=(t,a)=>{g(t),C(a),u(!0)},k=t=>{g(null),u(!1)},S=(t,a)=>{f&&(N(f,y==="present",a),k())};return b?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx(_,{})}):e.jsxs("div",{className:"container mx-auto px-4 h-full",children:[e.jsx(E,{header:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-bold mb-1",children:"Normal Attendance"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:M})]}),e.jsx("div",{className:"flex items-center gap-2 mt-2 md:mt-0",children:e.jsx(o,{size:"sm",variant:"plain",icon:e.jsx(P,{}),onClick:j,children:"Refresh"})})]}),children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-600",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"User"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Role"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-600",children:x.length>0?x.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(B,{size:"sm",src:t.user.profileImage,className:"mr-3",icon:e.jsx(L,{})}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium text-gray-900 dark:text-gray-200",children:[t.user.firstName," ",t.user.lastName]}),e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:t.user.email})]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx(w,{content:t.user.role.replace("_"," "),innerClass:"bg-blue-500 text-white"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx(w,{content:t.present?"Present":"Absent",innerClass:`${t.present?"bg-emerald-500 text-white":"bg-red-500 text-white"}`})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(o,{size:"xs",variant:"solid",color:"green",icon:e.jsx(H,{}),onClick:()=>D(t.user._id,"present"),disabled:m||t.present,children:"Present"}),e.jsx(o,{size:"xs",variant:"solid",color:"red",icon:e.jsx(z,{}),onClick:()=>N(t.user._id,!1),disabled:m||!t.present,children:"Absent"})]})})]},t.user._id)):e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"px-6 py-4 text-center text-gray-500 dark:text-gray-400",children:"No attendance records found"})})})]})})}),e.jsx(O,{isOpen:Y,onClose:k,onConfirm:S,modalType:y})]})};export{He as default};
