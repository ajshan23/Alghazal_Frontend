import{r as i,j as e,v as k}from"./index-BqYC2zCO.js";import{A as K}from"./AdaptableCard-DChiyDM1.js";import{D as E}from"./DataTable-CIH-lnfj.js";import{W as B,$ as H,N as M,V as P,_ as V}from"./index-CErL3g3x.js";import{u as z}from"./useQuery-BEa8BXoD.js";import{d as F}from"./debounce-Mlq-s6K6.js";import{I as R}from"./Input-CF7OdvAt.js";import{d as _,f as $}from"./api-Cc-UVHFs.js";import{h as q}from"./moment-C5S46NFB.js";import{C as L}from"./ConfirmDialog-DSkSlVFC.js";import{t as v,N}from"./toast-BNCR3rph.js";import"./Alert-Praf8Fi9.js";import"./index-BhxlP8yV.js";import"./Badge-CrbEpOhk.js";import{B as d}from"./Button-BZH25-Aw.js";import"./index-Bm5J6gtn.js";import"./Card-DiA6JKLe.js";import"./index-o6PoulbO.js";import"./Dialog-C85wTnEL.js";import"./Drawer-3BaRt1RV.js";import"./index-BNWCw_o_.js";import"./FormItem-FeS_vrRF.js";import"./useUniqueId-BmsTzdR7.js";import"./Upload-B1V-WMlx.js";import"./index-fwAOcRNC.js";import"./index-BkSrbwb3.js";import"./ScrollBar-bvGQZvnP.js";import"./Select-3fyDv9Rf.js";import"./Tag-DOC98LxQ.js";import{a as Y}from"./index-BdZOEYLW.js";import"./Views-B3egHxO-.js";import"./toString-sucKyfO-.js";import"./context-CKHslMnf.js";import"./StatusIcon-CrxJz663.js";import"./CloseButton-L6WjsDsk.js";import"./chainedFunction-BxZSneMW.js";import"./proxy-DBs-aCG0.js";import"./floating-ui.react-DBGHfBho.js";import"./floating-ui.dom-B_iSk-nO.js";import"./index-BLbmKy6n.js";import"./_getPrototype-_N1fRqzo.js";import"./index-Z1Egzvm9.js";import"./index-DtRKDKi1.js";import"./index-BnTamqJo.js";import"./defineProperty-DRmM3rRU.js";import"./typeof-QjJsDpFa.js";import"./hoist-non-react-statics.cjs-7CwaeXnJ.js";const Q=({isOpen:r,onClose:s,shopId:o,shopName:c,refetch:n})=>{const[l,m]=i.useState(!1);if(!r||!o)return null;const p=async()=>{var x,h;m(!0);try{await _(o),n(),v.push(e.jsx(N,{title:"Shop deleted",type:"success",duration:2500,children:"The shop has been successfully deleted."}),{placement:"top-center"}),s()}catch(a){console.error("Delete failed:",a),v.push(e.jsx(N,{title:"Failed to delete shop",type:"danger",duration:2500,children:((h=(x=a==null?void 0:a.response)==null?void 0:x.data)==null?void 0:h.message)||a.message||"Something went wrong"}),{placement:"top-center"})}finally{m(!1)}};return e.jsxs(L,{isOpen:r,type:"danger",title:"Delete Shop",confirmButtonColor:"red-600",onClose:s,onRequestClose:s,onCancel:s,onConfirm:p,confirmButtonDisabled:l,children:[e.jsxs("p",{children:["Are you sure you want to delete",c?` the shop "${c}"`:" this shop","? This action cannot be undone."]}),l&&e.jsx("div",{className:"mt-4 flex justify-center",children:e.jsx("div",{className:"w-6 h-6 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"})})]})},W=({row:r,onDeleteClick:s})=>{const o=k();return e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(d,{size:"sm",variant:"plain",icon:e.jsx(M,{}),onClick:()=>o(`/app/shop-details/${r._id}`),className:"text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300 transition-colors",tooltip:"View Shop"}),e.jsx(d,{size:"sm",variant:"plain",icon:e.jsx(P,{}),onClick:()=>o(`/app/new-shop/${r._id}`),className:"text-gray-600 hover:text-gray-800 dark:text-gray-400 dark:hover:text-gray-300 transition-colors",tooltip:"Edit Shop"}),e.jsx(d,{size:"sm",variant:"plain",icon:e.jsx(V,{}),onClick:()=>s(r._id),className:"text-red-600 hover:text-red-800 dark:text-red-400 dark:hover:text-red-300 transition-colors",tooltip:"Delete Shop"})]})},G=({row:r})=>e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-gradient-to-r from-blue-500 to-indigo-600 rounded-lg mr-3",children:e.jsx(Y,{className:"text-white text-lg"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-gray-800 dark:text-white",children:r.shopName}),e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:["#",r.shopNo]})]})]}),J=({contact:r,email:s})=>e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-gray-700 dark:text-gray-300 font-medium",children:r}),e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:s})]}),U=({address:r})=>e.jsx("div",{className:"max-w-[200px]",children:e.jsx("span",{className:"text-gray-700 dark:text-gray-300 line-clamp-2",children:r})}),X=({vat:r})=>e.jsxs("span",{className:"inline-flex items-center px-3 py-1 rounded-full bg-blue-50 dark:bg-blue-900/20 text-blue-700 dark:text-blue-300 text-xs font-medium border border-blue-200 dark:border-blue-800",children:["VAT: ",r]}),Z=()=>{var j,y;const r=i.useRef(null),s=k(),[o,c]=i.useState(""),[n,l]=i.useState({page:1,limit:10}),[m,p]=i.useState(!1),[x,h]=i.useState(null),{data:a,isLoading:w,error:f,refetch:b}=z({queryKey:["shops",n.page,n.limit,o],queryFn:()=>$({page:n.page,limit:n.limit,search:o})}),S=((j=a==null?void 0:a.data)==null?void 0:j.shops)||[],u=((y=a==null?void 0:a.data)==null?void 0:y.pagination)||{total:0,page:1,limit:10},C=i.useMemo(()=>F(t=>{c(t),l(g=>({...g,page:1}))},500),[]),D=t=>{C(t.target.value)},A=t=>{h(t),p(!0)},I=i.useMemo(()=>[{header:"Shop",accessorKey:"shopName",cell:t=>e.jsx(G,{row:t.row.original})},{header:"Address",accessorKey:"address",cell:t=>e.jsx(U,{address:t.row.original.address})},{header:"VAT",accessorKey:"vat",cell:t=>e.jsx(X,{vat:t.row.original.vat})},{header:"Owner",accessorKey:"ownerName",cell:t=>e.jsx("span",{className:"font-medium text-gray-800 dark:text-white",children:t.row.original.ownerName})},{header:"Contact Info",accessorKey:"contact",cell:t=>e.jsx(J,{contact:t.row.original.contact,email:t.row.original.ownerEmail})},{header:"Created",accessorKey:"createdAt",cell:t=>e.jsx("span",{className:"text-gray-600 dark:text-gray-400 text-sm font-medium",children:q(t.row.original.createdAt).format("DD MMM YY")})},{header:"Actions",id:"action",cell:t=>e.jsx(W,{row:t.row.original,onDeleteClick:A}),enableSorting:!1}],[]),T=t=>{l(g=>({...g,page:t}))},O=t=>{l(g=>({page:1,limit:t}))};return f?e.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-xl p-6 text-center",children:[e.jsx("div",{className:"text-red-600 dark:text-red-400 font-medium mb-2",children:"Error loading shops"}),e.jsx("div",{className:"text-sm text-red-500 dark:text-red-300",children:f.message}),e.jsx(d,{className:"mt-4",onClick:()=>b(),variant:"solid",children:"Try Again"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4 mb-6 p-6 bg-white dark:bg-gray-800 rounded-xl shadow-lg border border-gray-100 dark:border-gray-700",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-800 dark:text-white",children:"Shops"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsx(R,{placeholder:"Search shops...",onChange:D,className:"max-w-md",prefix:e.jsx(B,{className:"text-lg text-gray-400"})}),e.jsx(d,{variant:"solid",icon:e.jsx(H,{}),className:"bg-gradient-to-r from-blue-500 to-indigo-600 hover:from-blue-600 hover:to-indigo-700 text-white",onClick:()=>s("/app/new-shop"),children:"Add Shop"})]})]}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-lg border border-gray-100 dark:border-gray-700 overflow-hidden",children:e.jsx(E,{ref:r,columns:I,data:S,skeletonAvatarColumns:[0],skeletonAvatarProps:{className:"rounded-md"},loading:w,pagingData:{total:u.total,pageIndex:u.page,pageSize:u.limit},onPaginationChange:T,onSelectChange:O})}),e.jsx(Q,{isOpen:m,onClose:()=>p(!1),shopId:x,refetch:b})]})},Qe=()=>e.jsx(K,{className:"h-full",bodyClass:"h-full",children:e.jsx(Z,{})});export{Qe as default};
