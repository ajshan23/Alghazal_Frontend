import{r as j,j as e,v as R,a8 as q}from"./index-CZ-QxqVN.js";import{t as S,N as C}from"./toast-CoCmtbLn.js";import{F as T,a as h}from"./FormItem-BFRIpM45.js";import{B as F}from"./Button-wTWRjSOp.js";import{S as z}from"./StickyFooter-K7CPbFFZ.js";import{F as $,a as P,b as N}from"./formik.esm-BJAcCTJf.js";import{A as U}from"./index-Dv3L-RrQ.js";import{_ as B}from"./index-kD3pbGz6.js";import{c as V,b as g}from"./index.esm-3ESt5Gw2.js";import"./Alert-vZZK0s39.js";import"./index-DdzAiQaI.js";import"./Badge-M_R8BM5O.js";import"./index-WCrMc_mB.js";import"./Card-DYSpZm-g.js";import"./index-Dhhfgcmn.js";import"./Dialog-5Q7WvFhs.js";import"./Drawer-Cgxg1eSD.js";import"./index-BRrKuFuY.js";import"./useUniqueId-BHonA5r7.js";import{I as b}from"./Input-C15wo5ys.js";import"./Upload-CNTsixo0.js";import"./index-Cee-dHef.js";import"./index-CUYy2E4V.js";import"./ScrollBar-CX8t2iP4.js";import"./Select-ukccBfLg.js";import"./Tag-gTkDLVan.js";import{A as E}from"./AdaptableCard-Ce_KsDG0.js";import"./Views-BmihdypO.js";import"./SvgIcon-tuMtLRs6.js";import{C as _}from"./ConfirmDialog-m53FmWqq.js";import"./DataTable-C-dnd2Pg.js";import{a as H,e as L,b as G}from"./api-BwEYxPZ0.js";import"./StatusIcon-D9-As4b9.js";import"./CloseButton-DDicOJ3W.js";import"./chainedFunction-BxZSneMW.js";import"./proxy-D7sJR9rS.js";import"./context-B6r7oiwN.js";import"./index-cPHdE-6C.js";import"./cloneDeep-DJN0yfLA.js";import"./hoist-non-react-statics.cjs-C_KtrfhP.js";import"./floating-ui.react-B1qnMOd0.js";import"./floating-ui.dom-B_iSk-nO.js";import"./_getPrototype-lWKxFJo-.js";import"./index-DzN3DWMt.js";import"./index-CFpcu7wG.js";import"./toString-DttkkGgf.js";import"./index-D2JWHt9J.js";import"./defineProperty-DRmM3rRU.js";import"./typeof-QjJsDpFa.js";import"./useThemeClass-rxUVokHK.js";const I=j.forwardRef((m,n)=>{const{type:d,initialData:o={shopName:"",shopNo:"",address:"",vat:"",ownerName:"",ownerEmail:"",contact:"",shopAttachments:[]},onFormSubmit:f,onDiscard:w,onDelete:O}=m,[u,x]=j.useState([]);j.useEffect(()=>{o.shopAttachments&&x(o.shopAttachments)},[o]);const a=V().shape({shopName:g().required("Shop Name is required"),shopNo:g(),address:g().required("Address is required"),vat:g(),ownerName:g(),ownerEmail:g().email("Invalid email format"),contact:g()});return e.jsx($,{innerRef:n,initialValues:{...o,contact:o.contact||"",shopName:o.shopName||"",shopNo:o.shopNo||"",address:o.address||"",vat:o.vat||"",ownerName:o.ownerName||"",ownerEmail:o.ownerEmail||"",shopAttachments:o.shopAttachments||[]},validationSchema:a,onSubmit:async(r,{setSubmitting:i,setErrors:t})=>{var s,v;const l=new FormData;l.append("shopName",r.shopName||""),r.shopNo&&l.append("shopNo",r.shopNo),l.append("address",r.address||""),r.vat&&l.append("vat",r.vat),r.ownerName&&l.append("ownerName",r.ownerName),r.ownerEmail&&l.append("ownerEmail",r.ownerEmail),r.contact&&l.append("contact",r.contact),u.forEach(y=>{l.append("shopAttachments",y)});try{await f(l,i)}catch(y){i(!1),(s=y.message)!=null&&s.includes("Shop already exists")?t({shopName:"This shop name is already registered"}):(v=y.message)!=null&&v.includes("Shop with this number already exists")&&t({shopNo:"This shop number is already registered"})}},enableReinitialize:!0,validateOnChange:!0,validateOnBlur:!0,children:({values:r,touched:i,errors:t,isSubmitting:l,setFieldValue:s,handleBlur:v})=>{const y=p=>{if(p.target.files&&p.target.files.length>0){const c=Array.from(p.target.files),A=[...u,...c];x(A),s("shopAttachments",A),v({target:{name:"shopAttachments"}})}},M=p=>{const c=[...u];c.splice(p,1),x(c),s("shopAttachments",c),v({target:{name:"shopAttachments"}})};return e.jsx(P,{children:e.jsxs(T,{children:[e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:e.jsxs("div",{className:"lg:col-span-2",children:[e.jsxs(E,{divider:!0,className:"mb-4",children:[e.jsx("h5",{className:"mb-4",children:"Shop Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(h,{label:"Shop Name",invalid:!!t.shopName&&i.shopName,errorMessage:t.shopName,children:e.jsx(N,{type:"text",autoComplete:"off",name:"shopName",placeholder:"Shop Name",component:b,validateOnBlur:!0})}),e.jsx(h,{label:"Shop Number (Optional)",invalid:!!t.shopNo&&i.shopNo,errorMessage:t.shopNo,children:e.jsx(N,{type:"text",autoComplete:"off",name:"shopNo",placeholder:"Shop Number (Optional)",component:b,validateOnBlur:!0})})]}),e.jsx(h,{label:"Address",invalid:!!t.address&&i.address,errorMessage:t.address,children:e.jsx(N,{type:"text",autoComplete:"off",name:"address",placeholder:"Shop Address",component:b,validateOnBlur:!0})}),e.jsx(h,{label:"VAT (Optional)",invalid:!!t.vat&&i.vat,errorMessage:t.vat,children:e.jsx(N,{type:"text",autoComplete:"off",name:"vat",placeholder:"VAT Number (Optional)",component:b,validateOnBlur:!0})})]}),e.jsxs(E,{divider:!0,className:"mb-4",children:[e.jsx("h5",{className:"mb-4",children:"Owner Information (Optional)"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(h,{label:"Owner Name (Optional)",invalid:!!t.ownerName&&i.ownerName,errorMessage:t.ownerName,children:e.jsx(N,{type:"text",autoComplete:"off",name:"ownerName",placeholder:"Owner Name (Optional)",component:b,validateOnBlur:!0})}),e.jsx(h,{label:"Owner Email (Optional)",invalid:!!t.ownerEmail&&i.ownerEmail,errorMessage:t.ownerEmail,children:e.jsx(N,{type:"email",autoComplete:"off",name:"ownerEmail",placeholder:"Owner Email (Optional)",component:b,validateOnBlur:!0})}),e.jsx(h,{label:"Owner Contact (Optional)",invalid:!!t.contact&&i.contact,errorMessage:t.contact,children:e.jsx(N,{type:"text",autoComplete:"off",name:"contact",placeholder:"Contact Number (Optional)",component:b,validateOnBlur:!0})})]})]}),e.jsxs(E,{divider:!0,className:"mb-4",children:[e.jsx("h5",{className:"mb-4",children:"Shop Attachments"}),e.jsxs(h,{label:"Attachments",invalid:!!t.shopAttachments&&i.shopAttachments,errorMessage:t.shopAttachments,children:[e.jsx("div",{className:"mb-4",children:e.jsx("input",{type:"file",multiple:!0,onChange:y,onBlur:()=>v({target:{name:"shopAttachments"}}),className:`block w-full text-sm text-gray-500
                            file:mr-4 file:py-2 file:px-4
                            file:rounded-md file:border-0
                            file:text-sm file:font-semibold
                            file:bg-blue-50 file:text-blue-700
                            hover:file:bg-blue-100
                            dark:file:bg-blue-900/30 dark:file:text-blue-300
                            dark:hover:file:bg-blue-900/20`,accept:".pdf,.jpg,.jpeg,.png,.doc,.docx"})}),u.length>0&&e.jsx("div",{className:"space-y-2",children:u.map((p,c)=>{const A=p instanceof File,k=A?p.name:p.fileName,D=A?void 0:p.filePath;return e.jsxs("div",{className:"flex items-center justify-between p-2 border rounded",children:[D?e.jsx("a",{href:D,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-blue-600 dark:text-blue-300 truncate hover:underline",children:k}):e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300 truncate",children:k}),e.jsx("button",{type:"button",onClick:()=>M(c),className:"text-red-500 hover:text-red-700 dark:text-red-400 dark:hover:text-red-300 ml-2",children:e.jsx(B,{})})]},c)})})]})]})]})}),e.jsxs(z,{className:"-mx-8 px-8 flex items-center justify-between py-4",stickyClass:"border-t bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700",children:[e.jsx("div",{children:d==="edit"&&O&&e.jsx(J,{onDelete:O})}),e.jsxs("div",{className:"md:flex items-center",children:[e.jsx(F,{size:"sm",className:"ltr:mr-3 rtl:ml-3",type:"button",onClick:()=>w==null?void 0:w(),children:"Discard"}),e.jsx(F,{size:"sm",variant:"solid",loading:l,icon:e.jsx(U,{}),type:"submit",children:"Save"})]})]})]})})}})});I.displayName="ShopDetailsForm";const J=({onDelete:m})=>{const[n,d]=j.useState(!1),o=()=>{d(!1),m==null||m(d)},f=()=>{d(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(F,{className:"text-red-600",variant:"plain",size:"sm",icon:e.jsx(B,{}),type:"button",onClick:()=>d(!0),children:"Delete"}),e.jsx(_,{isOpen:n,type:"danger",title:"Delete shop",confirmButtonColor:"red-600",onClose:f,onRequestClose:f,onCancel:f,onConfirm:o,children:e.jsx("p",{children:"Are you sure you want to delete this shop?"})})]})},K={shopName:"",shopNo:"",address:"",vat:"",ownerName:"",ownerEmail:"",contact:"",shopAttachments:[]},Le=()=>{const m=R(),{id:n}=q(),[d,o]=j.useState(K);console.log("initialData:",d);const[f,w]=j.useState(!!n);j.useEffect(()=>{n&&(async()=>{try{const a=await H(n);if(!a||!a.data)throw new Error("Invalid shop data");o({shopName:a.data.shopName||"",shopNo:a.data.shopNo||"",address:a.data.address||"",vat:a.data.vat||"",ownerName:a.data.ownerName||"",ownerEmail:a.data.ownerEmail||"",contact:a.data.contact||"",shopAttachments:a.data.shopAttachments||[]}),w(!1)}catch(a){console.error("Error fetching shop:",a),w(!1),S.push(e.jsx(C,{title:"Failed to fetch shop data",type:"danger",duration:2500,children:a.message||"Something went wrong"}),{placement:"top-center"}),m("/app/user-list")}})()},[n,m]);const O=async(x,a)=>{var r,i,t,l;a(!0);try{let s;if(n?s=await L(n,x):s=await G(x),s.status===(n?200:201))a(!1),S.push(e.jsxs(C,{title:`Successfully ${n?"updated":"added"} shop`,type:"success",duration:2500,children:["Shop ",n?"updated":"added"," successfully"]}),{placement:"top-center"}),m("/app/shop-view");else throw new Error(((i=(r=s==null?void 0:s.response)==null?void 0:r.data)==null?void 0:i.message)||"Unexpected status code")}catch(s){console.error("Error during form submission:",s),a(!1),S.push(e.jsx(C,{title:`Error ${n?"updating":"adding"} shop`,type:"danger",duration:2500,children:((l=(t=s==null?void 0:s.response)==null?void 0:t.data)==null?void 0:l.message)||s.message}),{placement:"top-center"})}},u=()=>{m("/app/shop-view")};return f?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):e.jsx(I,{type:n?"edit":"new",initialData:d,onFormSubmit:O,onDiscard:u})};export{Le as default};
