import{r as m,j as a,m as W}from"./index-CZ-QxqVN.js";import{C as z}from"./ConfirmDialog-m53FmWqq.js";import{t as M,N as k}from"./toast-CoCmtbLn.js";import{d as G,c as J,f as Z,h as X,i as F,j as ee,k as ae,l as te,m as oe,n as se}from"./api-CU6E8JBH.js";import"./Alert-vZZK0s39.js";import"./index-DdzAiQaI.js";import"./Badge-M_R8BM5O.js";import{B as ne}from"./Button-wTWRjSOp.js";import{D as I}from"./index-WCrMc_mB.js";import"./Card-DYSpZm-g.js";import"./index-Dhhfgcmn.js";import"./Dialog-5Q7WvFhs.js";import{D as le}from"./Drawer-Cgxg1eSD.js";import"./index-BRrKuFuY.js";import{a as b}from"./FormItem-BFRIpM45.js";import"./useUniqueId-BHonA5r7.js";import"./Input-C15wo5ys.js";import"./Upload-CNTsixo0.js";import"./index-Cee-dHef.js";import"./index-CUYy2E4V.js";import"./ScrollBar-CX8t2iP4.js";import{S as C}from"./Select-ukccBfLg.js";import"./Tag-gTkDLVan.js";import{F as re,a as ie,b as x}from"./formik.esm-BJAcCTJf.js";import{c as ce}from"./index.esm-3ESt5Gw2.js";import{d as de}from"./index-yKKiR9wp.js";import{f as P}from"./format-CBpsKyOP.js";import{Z as ue}from"./index-kD3pbGz6.js";const Te=({isOpen:v,onClose:p,bill:t,refetch:c,reportType:u})=>{const[s,D]=m.useState(!1);if(console.log(u,"123 reportType inn BillDeleteConfirmation"),!v||!t)return null;const j=()=>{var y,g;switch(t.billType||t.reportType||u){case"general":return`Delete General Bill ${t.invoiceNo?`#${t.invoiceNo}`:""}`;case"fuel":return"Delete Fuel Bill";case"mess":return"Delete Mess Bill";case"vehicle":return`Delete Vehicle Bill ${(y=t.vehicle)!=null&&y.vehicleNumber?`(Vehicle ${t.vehicle.vehicleNumber})`:""}`;case"accommodation":return`Delete Accommodation Bill ${(g=t.accommodation)!=null&&g.location?`(${t.accommodation.location})`:""}`;case"adib":return"Delete Adib Report";case"expense":return"Delete Expense Report";case"profit":return"Delete Profit Report";case"labour":return"Delete Labour Expenses Report";case"payroll":return"Delete Payroll Report";case"visaExpense":return"Delete Visa Expense Report";default:return"Delete Bill"}};console.log(t,"123 bill.billType inn BillDeleteConfirmation");const N=()=>{var y,g;switch(t.billType||t.reportType||u){case"general":return`Are you sure you want to delete this general bill${t.invoiceNo?` (Invoice #${t.invoiceNo})`:""}? This action cannot be undone.`;case"fuel":return"Are you sure you want to delete this fuel bill? This action cannot be undone.";case"mess":return"Are you sure you want to delete this mess bill? This action cannot be undone.";case"vehicle":return`Are you sure you want to delete this vehicle bill${(y=t.vehicle)!=null&&y.vehicleNumber?` for vehicle ${t.vehicle.vehicleNumber}`:""}? This action cannot be undone.`;case"accommodation":return`Are you sure you want to delete this accommodation bill${(g=t.accommodation)!=null&&g.location?` for ${t.accommodation.location}`:""}? This action cannot be undone.`;case"adib":return"Are you sure you want to delete this adib report? This action cannot be undone.";case"expense":return"Are you sure you want to delete this expense report? This action cannot be undone.";case"profit":return"Are you sure you want to delete this profit report? This action cannot be undone.";case"labour":return"Are you sure you want to delete this labour expenses report? This action cannot be undone.";case"payroll":return"Are you sure you want to delete this payroll report? This action cannot be undone.";case"visaExpense":return"Are you sure you want to delete this visa expense report? This action cannot be undone.";default:return"Are you sure you want to delete this bill? This action cannot be undone."}},A=async()=>{var y,g;D(!0);try{await t.billType?G(t._id):u==="profit"?J(t._id):u==="labour"?Z(t._id):u==="payroll"?X(t._id):u==="visaExpense"?F(t._id):ee(t._id),c(),M.push(a.jsx(k,{title:`${j()} deleted successfully`,type:"success",duration:2500,children:t.billType?"The bill has been successfully deleted.":"The report has been successfully deleted."}),{placement:"top-center"}),p()}catch(f){console.error("Delete failed:",f),M.push(a.jsx(k,{title:`Failed to delete ${j()}`,type:"danger",duration:2500,children:((g=(y=f==null?void 0:f.response)==null?void 0:y.data)==null?void 0:g.message)||f.message||"Something went wrong"}),{placement:"top-center"})}finally{D(!1)}};return a.jsxs(z,{isOpen:v,type:"danger",title:j(),confirmButtonColor:"red-600",onClose:p,onRequestClose:p,onCancel:p,onConfirm:A,confirmButtonDisabled:s,children:[a.jsx("p",{children:N()}),s&&a.jsx("div",{className:"mt-4 flex justify-center",children:a.jsx("div",{className:"w-6 h-6 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"})})]})},L=[{label:"ADVANCE",value:"advance"},{label:"ADIB",value:"adib"},{label:"Cash",value:"cash"},{label:"MASHREQ CARD",value:"mashreq_card"},{label:"ATHEER PLUS",value:"atheer_plus"},{label:"ADCB CARD",value:"adcb_card"},{label:"ADCB BANK",value:"adcb_bank"},{label:"MASHREQ BANK",value:"mashreq_bank"},{label:"OWNER PERSONAL PAY",value:"owner_personal_pay"},{label:"MR.SYED PAY",value:"mr_syed_pay"},{label:"OTHER PAY",value:"other_pay"},{label:"CHEQUE",value:"cheque"},{label:"WIO CARD",value:"wio_card"},{label:"WIO BANK",value:"wio_bank"}],Ue=({isOpen:v,onClose:p,onRequestClose:t,billType:c,onApplyFilters:u,currentFilters:s})=>{const[D,j]=m.useState([]),[N,A]=m.useState([]),[y,g]=m.useState([]),[f,O]=m.useState([]),[T,R]=m.useState(!1),[U,V]=m.useState(!1),[H,B]=m.useState(!1),[Y,_]=m.useState(!1);m.useEffect(()=>{(async()=>{var r,h;try{_(!0);const n=await se();O(((h=(r=n==null?void 0:n.data)==null?void 0:r.users)==null?void 0:h.map(d=>({label:`${d.firstName} ${d.lastName}`,value:d._id})))||[])}catch(n){console.error("Error loading users:",n)}finally{_(!1)}})()},[]);const w=m.useCallback(async(l="")=>{var r,h;R(!0);try{const n=await ae(l,1,30);j(((h=(r=n==null?void 0:n.data)==null?void 0:r.shops)==null?void 0:h.map(d=>({label:d.shopNo?`${d.shopName} (${d.shopNo})`:d.shopName,value:d._id})))||[])}catch(n){console.error("Error loading shops:",n)}finally{R(!1)}},[]),S=m.useCallback(async(l="")=>{var r,h;V(!0);try{const n=await te(l,1,30);A(((h=(r=n==null?void 0:n.data)==null?void 0:r.categories)==null?void 0:h.map(d=>({label:d.name,value:d._id})))||[])}catch(n){console.error("Error loading categories:",n)}finally{V(!1)}},[]),E=m.useCallback(async(l="")=>{var r,h;B(!0);try{const n=await oe(l,1,30);g(((h=(r=n==null?void 0:n.data)==null?void 0:r.vehicles)==null?void 0:h.map(d=>({label:d.vehicleNumber,value:d._id})))||[])}catch(n){console.error("Error loading vehicles:",n)}finally{B(!1)}},[]);m.useEffect(()=>{v&&(w(),S(),E())},[v,w,S,E]);const $=new Date,q={startDate:(s==null?void 0:s.startDate)||"",endDate:(s==null?void 0:s.endDate)||"",category:(s==null?void 0:s.category)||"",shop:(s==null?void 0:s.shop)||"",vehicleNo:(s==null?void 0:s.vehicleNo)||"",paymentMethod:(s==null?void 0:s.paymentMethod)||"",employee:(s==null?void 0:s.employee)||""},K=l=>{const r={};l.startDate&&(r.startDate=l.startDate),l.endDate&&(r.endDate=l.endDate),l.category&&(r.category=l.category),l.shop&&(r.shop=l.shop),l.vehicleNo&&(r.vehicle=l.vehicleNo),l.paymentMethod&&(r.paymentMethod=l.paymentMethod),l.employee&&(r.employee=l.employee),console.log("Applying Filters from Drawer:",r),u==null||u(r),setTimeout(()=>{p==null||p(new MouseEvent("click"))},100)},Q=l=>{l(),u==null||u({startDate:"",endDate:"",category:"",shop:"",vehicle:"",paymentMethod:"",employee:""})};return a.jsx(le,{title:`Filter ${c.charAt(0).toUpperCase()+c.slice(1)} Bills`,isOpen:v,onClose:p,onRequestClose:t,children:a.jsx(re,{initialValues:q,validationSchema:ce({}),onSubmit:K,children:({values:l,errors:r,touched:h,resetForm:n,setFieldValue:d})=>a.jsxs(ie,{className:"space-y-4",children:[a.jsx(b,{label:"Start Date",invalid:!!r.startDate&&h.startDate,children:a.jsx(x,{name:"startDate",children:({field:o,form:i})=>a.jsx(I,{placeholder:"Select Start Date",value:o.value?new Date(o.value):null,maxDate:$,onChange:e=>i.setFieldValue(o.name,e?P(new Date(e.getFullYear(),e.getMonth(),e.getDate()),"yyyy-MM-dd"):"")})})}),a.jsx(b,{label:"End Date",invalid:!!r.endDate&&h.endDate,children:a.jsx(x,{name:"endDate",children:({field:o,form:i})=>a.jsx(I,{placeholder:"Select End Date",value:o.value?new Date(o.value):null,maxDate:$,onChange:e=>i.setFieldValue(o.name,e?P(new Date(e.getFullYear(),e.getMonth(),e.getDate()),"yyyy-MM-dd"):"")})})}),(c==="general"||c==="mess"||c==="accommodation"||c==="vehicle"||c==="adib")&&a.jsx(b,{label:"Shop Name",children:a.jsx(x,{name:"shop",children:({field:o,form:i})=>a.jsx(C,{placeholder:"Select Shop",options:D,value:D.find(e=>e.value===o.value),onChange:e=>i.setFieldValue(o.name,(e==null?void 0:e.value)||""),onInputChange:e=>{w(e)},onClear:()=>{i.setFieldValue(o.name,""),w()},isClearable:!0,loading:T})})}),(c==="general"||c==="adib")&&a.jsx(b,{label:"Category",children:a.jsx(x,{name:"category",children:({field:o,form:i})=>a.jsx(C,{placeholder:"Select Category",options:N,value:N.find(e=>e.value===o.value),onChange:e=>i.setFieldValue(o.name,(e==null?void 0:e.value)||""),onInputChange:e=>{S(e)},onClear:()=>{i.setFieldValue(o.name,""),S()},isClearable:!0,loading:U})})}),(c==="vehicle"||c==="fuel")&&a.jsx(b,{label:"Vehicle No",children:a.jsx(x,{name:"vehicleNo",children:({field:o,form:i})=>a.jsx(C,{placeholder:"Select Vehicle",options:y,value:y.find(e=>e.value===o.value),onChange:e=>i.setFieldValue(o.name,(e==null?void 0:e.value)||""),onInputChange:e=>{E(e)},onClear:()=>{i.setFieldValue(o.name,""),E()},isClearable:!0,loading:H})})}),["general","mess","fuel","vehicle","accommodation"].includes(c)&&a.jsx(b,{label:"Payment Method",children:a.jsx(x,{name:"paymentMethod",children:({field:o,form:i})=>a.jsx(C,{placeholder:"Select Payment Method",options:L,value:L.find(e=>e.value===o.value),onChange:e=>i.setFieldValue(o.name,(e==null?void 0:e.value)||""),onClear:()=>i.setFieldValue(o.name,""),isClearable:!0})})}),(c==="visaExpense"||c==="labour"||c==="payroll")&&a.jsx(b,{label:"Employee",children:a.jsx(x,{name:"employee",children:({field:o,form:i})=>a.jsx(C,{placeholder:"Select Employee",options:f,value:f.find(e=>e.value===o.value),onChange:e=>i.setFieldValue(o.name,(e==null?void 0:e.value)||""),onClear:()=>i.setFieldValue(o.name,""),isClearable:!0,loading:Y})})}),a.jsxs("div",{className:"mt-8 flex justify-end gap-2",children:[a.jsxs("button",{type:"button",onClick:()=>Q(n),className:"flex items-center gap-1 text-sm bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-white px-3 py-1.5 rounded hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors",children:[a.jsx(de,{className:"text-base"}),"Reset"]}),a.jsx("button",{type:"submit",className:"text-sm bg-blue-600 text-white px-3 py-1.5 rounded hover:bg-blue-700 transition-colors",children:"Apply Filters"})]})]})},`${v}-${JSON.stringify(s)}`)})},He=({to:v,title:p})=>a.jsx("div",{className:"flex flex-col lg:flex-row lg:items-center gap-2",children:a.jsx(W,{className:"block lg:inline-block md:mb-0 mb-4",to:v,children:a.jsx(ne,{block:!0,variant:"solid",size:"sm",icon:a.jsx(ue,{}),children:p})})});export{He as B,Te as a,Ue as b};
