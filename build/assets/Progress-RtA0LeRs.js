import{r as o,a8 as L,j as e,T as v}from"./index-CZ-QxqVN.js";import{C as g}from"./Card-DYSpZm-g.js";import{I as w}from"./Input-C15wo5ys.js";import{A as y}from"./index-DdzAiQaI.js";import{B as C}from"./Button-wTWRjSOp.js";import{b3 as P,a0 as G,b4 as $,a9 as B,a2 as z,b5 as T,b6 as A,ax as q,ay as O,N as W,H as X}from"./index-kD3pbGz6.js";import{a as Y,b as J,c as K,d as M}from"./api-DJ7f0u7G.js";import"./Alert-vZZK0s39.js";import"./Badge-M_R8BM5O.js";import"./index-WCrMc_mB.js";import"./index-Dhhfgcmn.js";import"./Dialog-5Q7WvFhs.js";import"./Drawer-Cgxg1eSD.js";import"./index-BRrKuFuY.js";import"./FormItem-BFRIpM45.js";import"./useUniqueId-BHonA5r7.js";import"./Upload-CNTsixo0.js";import"./index-Cee-dHef.js";import{t as u,N as f}from"./toast-CoCmtbLn.js";import"./index-CUYy2E4V.js";import"./ScrollBar-CX8t2iP4.js";import"./Select-ukccBfLg.js";import"./Tag-gTkDLVan.js";import{N as Q}from"./react-number-format.es-C-Q5QUvj.js";import{P as S}from"./ProgressBar-By4ednhB.js";import"./context-B6r7oiwN.js";import"./Views-BmihdypO.js";import"./toString-DttkkGgf.js";import"./floating-ui.react-B1qnMOd0.js";import"./floating-ui.dom-B_iSk-nO.js";import"./index-cPHdE-6C.js";import"./proxy-D7sJR9rS.js";import"./StatusIcon-D9-As4b9.js";import"./CloseButton-DDicOJ3W.js";import"./_getPrototype-lWKxFJo-.js";import"./index-DzN3DWMt.js";import"./index-CFpcu7wG.js";import"./chainedFunction-BxZSneMW.js";import"./index-D2JWHt9J.js";import"./defineProperty-DRmM3rRU.js";import"./typeof-QjJsDpFa.js";import"./hoist-non-react-statics.cjs-C_KtrfhP.js";const H=({src:a})=>e.jsx(y,{src:a,size:40,shape:"circle",className:"ring-2 ring-white dark:ring-gray-800 shadow-md"}),V=({status:a,time:p})=>{const l=(()=>{switch(a.toLowerCase()){case"approval":case"approved":return{bg:"bg-emerald-100 dark:bg-emerald-500/20",icon:e.jsx(X,{className:"text-emerald-600 dark:text-emerald-400"}),text:"Approved",textColor:"text-emerald-600 dark:text-emerald-400"};case"check":case"checked":return{bg:"bg-amber-100 dark:bg-amber-500/20",icon:e.jsx(W,{className:"text-amber-600 dark:text-amber-400"}),text:"Checked",textColor:"text-amber-600 dark:text-amber-400"};case"reject":case"rejected":return{bg:"bg-red-100 dark:bg-red-500/20",icon:e.jsx(O,{className:"text-red-600 dark:text-red-400"}),text:"Rejected",textColor:"text-red-600 dark:text-red-400"};case"progress_update":return{bg:"bg-indigo-100 dark:bg-indigo-500/20",icon:e.jsx(A,{className:"text-indigo-600 dark:text-indigo-400"}),text:"Progress Update",textColor:"text-indigo-600 dark:text-indigo-400"};default:return{bg:"bg-blue-100 dark:bg-blue-500/20",icon:e.jsx(q,{className:"text-blue-600 dark:text-blue-400"}),text:"General",textColor:"text-blue-600 dark:text-blue-400"}}})();return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ${l.bg} ${l.textColor} shadow-sm`,children:[e.jsx("span",{className:"mr-1",children:l.icon}),l.text]}),e.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:p})]})},Z=({comment:a})=>e.jsxs("div",{className:"flex mb-6 group",children:[e.jsxs("div",{className:"flex flex-col items-center mr-4",children:[e.jsx(H,{src:a.img}),e.jsx("div",{className:"w-px h-full bg-gradient-to-b from-indigo-200 to-purple-200 dark:from-gray-600 dark:to-gray-700 mt-2"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("span",{className:"font-semibold text-gray-900 dark:text-gray-100",children:a.name}),e.jsx(V,{status:a.actionType||"general",time:a.time})]}),a.progress!==void 0&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"Progress Update"}),e.jsxs("span",{className:"text-sm font-semibold text-indigo-600 dark:text-indigo-400",children:[a.progress,"%"]})]}),e.jsx(S,{percent:a.progress,showInfo:!1,strokeColor:"#4f46e5",trailColor:"#e0e7ff",className:"h-2 rounded-full"})]}),e.jsx("div",{className:"p-4 bg-gradient-to-r from-gray-50 to-slate-50 dark:from-gray-800 dark:to-gray-700 rounded-xl border border-gray-200 dark:border-gray-600 shadow-sm",children:e.jsx("p",{className:"text-gray-800 dark:text-gray-200",children:a.comment})})]})]}),ze=()=>{const[a,p]=o.useState(!0),[h,l]=o.useState(!1),[m,j]=o.useState(0),b=o.useRef(null),[N,k]=o.useState([]),{projectId:n}=L(),[U,_]=o.useState(!1),[I,E]=o.useState(!0),[c,R]=o.useState({workers:[],driver:null});o.useEffect(()=>{(async()=>{var d;try{const[s,t]=await Promise.all([Y(n),J(n)]),i=s.data.data,x=t.data.data,F=["team_assigned","work_started","in_progress","work_completed","quality_check","client_handover"].includes(i.status);_(F&&((d=i.assignedWorkers)==null?void 0:d.length)>0&&i.assignedDriver),x&&R({workers:x.workers||[],driver:x.driver||null})}catch(s){console.error("Error checking team assignment:",s),u.push(e.jsx(f,{title:"Error",type:"danger",children:"Failed to load team information"}))}finally{E(!1)}})()},[n]),o.useEffect(()=>{(async()=>{try{p(!0);const d=await K(n);if(d.data){const s=d.data.map(t=>{var i,x;return{id:t._id,name:(i=t.user)!=null&&i.firstName?`${t.user.firstName} ${t.user.lastName}`:"Unknown User",img:((x=t.user)==null?void 0:x.profileImage)||"/img/avatars/thumb-1.jpg",time:new Date(t.createdAt).toLocaleString(),comment:t.content,actionType:t.actionType,progress:t.progress}});k(s),s.length>0&&s[0].progress!==void 0&&j(s[0].progress)}}catch(d){console.error("Failed to fetch progress updates:",d),u.push(e.jsx(f,{title:"Error",type:"danger",children:"Failed to load progress updates"}))}finally{p(!1)}})()},[n]);const D=async()=>{var d;const r=(d=b.current)==null?void 0:d.value;if(r!=null&&r.trim())try{l(!0);const s=await M({projectId:n,progress:m,comment:r});if(s.data){const t={id:s.data._id,name:"You",img:"/img/avatars/thumb-1.jpg",time:"just now",comment:r,actionType:"progress_update",progress:m};k(i=>[t,...i]),b.current&&(b.current.value=""),u.push(e.jsx(f,{title:"Success",type:"success",children:"Progress updated successfully"}))}}catch(s){console.error("Failed to submit progress update:",s),u.push(e.jsx(f,{title:"Error",type:"danger",children:"Failed to update progress"}))}finally{l(!1)}};return I?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 via-white to-blue-50 dark:from-gray-900 dark:via-gray-850 dark:to-gray-900",children:e.jsx(v,{})}):U?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 via-white to-blue-50 dark:from-gray-900 dark:via-gray-850 dark:to-gray-900",children:e.jsx("div",{className:"container mx-auto p-6",children:e.jsxs(v,{loading:a,children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"p-2 bg-gradient-to-r from-purple-500 to-pink-600 rounded-lg",children:e.jsx(G,{className:"text-2xl text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-800 dark:text-white",children:"Project Progress"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Track and update the current status of the project"})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-3 gap-8 mb-8",children:[e.jsx("div",{className:"xl:col-span-1",children:e.jsxs(g,{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-xl border border-gray-100 dark:border-gray-700 overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-gray-800 dark:to-gray-750 p-6 border-b border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-gradient-to-r from-blue-500 to-indigo-600 rounded-lg",children:e.jsx(P,{className:"text-2xl text-white"})}),e.jsx("h3",{className:"text-xl font-bold text-gray-800 dark:text-white",children:"Assigned Team"})]})}),e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("h6",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 mb-3",children:["Workers (",c.workers.length,")"]}),e.jsxs("div",{className:"space-y-3",children:[c.workers.map(r=>e.jsxs("div",{className:"flex items-center p-3 bg-gradient-to-r from-gray-50 to-slate-50 dark:from-gray-700 dark:to-gray-600 rounded-xl border border-gray-200 dark:border-gray-600",children:[e.jsx(y,{src:r.profileImage,size:40}),e.jsxs("span",{className:"ml-3 dark:text-gray-200 font-medium",children:[r.firstName," ",r.lastName]})]},r._id)),c.workers.length===0&&e.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-sm py-2 text-center",children:"No workers assigned"})]})]}),e.jsxs("div",{children:[e.jsxs("h6",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 mb-3 flex items-center gap-2",children:[e.jsx($,{className:"text-indigo-600 dark:text-indigo-400"}),"Driver"]}),c.driver?e.jsxs("div",{className:"flex items-center p-3 bg-gradient-to-r from-gray-50 to-slate-50 dark:from-gray-700 dark:to-gray-600 rounded-xl border border-gray-200 dark:border-gray-600",children:[e.jsx(y,{src:c.driver.profileImage,size:40}),e.jsxs("span",{className:"ml-3 dark:text-gray-200 font-medium",children:[c.driver.firstName," ",c.driver.lastName]})]}):e.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-sm py-2 text-center",children:"No driver assigned"})]})]})})]})}),e.jsxs("div",{className:"xl:col-span-2",children:[e.jsxs(g,{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-xl border border-gray-100 dark:border-gray-700 overflow-hidden mb-8",children:[e.jsx("div",{className:"bg-gradient-to-r from-green-50 to-emerald-50 dark:from-gray-800 dark:to-gray-750 p-6 border-b border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-gradient-to-r from-green-500 to-emerald-600 rounded-lg",children:e.jsx(B,{className:"text-2xl text-white"})}),e.jsx("h3",{className:"text-xl font-bold text-gray-800 dark:text-white",children:"Current Progress"})]})}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h5",{className:"text-md font-semibold dark:text-gray-200",children:"Project Completion"}),e.jsx("span",{className:"text-xl font-bold text-indigo-600 dark:text-indigo-400",children:e.jsx(Q,{displayType:"text",value:m,suffix:"%",decimalScale:0})})]}),e.jsx(S,{percent:m,showInfo:!1,className:"mb-6",strokeColor:"#4f46e5",trailColor:"#e0e7ff",className:"h-3 rounded-full"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(w,{type:"range",min:"0",max:"100",step:"5",value:m,onChange:r=>j(Number(r.target.value)),className:"flex-1"}),e.jsxs("span",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 w-12 text-center",children:[m,"%"]})]})]})]}),e.jsxs(g,{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-xl border border-gray-100 dark:border-gray-700 overflow-hidden mb-8",children:[e.jsx("div",{className:"bg-gradient-to-r from-purple-50 to-pink-50 dark:from-gray-800 dark:to-gray-750 p-6 border-b border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-gradient-to-r from-purple-500 to-pink-600 rounded-lg",children:e.jsx(z,{className:"text-2xl text-white"})}),e.jsx("h3",{className:"text-xl font-bold text-gray-800 dark:text-white",children:"Progress History"})]})}),e.jsx("div",{className:"p-6",children:N.length>0?e.jsx("div",{className:"space-y-6",children:N.map(r=>e.jsx(Z,{comment:r},r.id))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(T,{className:"text-4xl text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"No progress updates yet"}),e.jsx("p",{className:"text-sm text-gray-400 dark:text-gray-500 mt-1",children:"Be the first to update the progress"})]})})]}),e.jsxs(g,{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-xl border border-gray-100 dark:border-gray-700 overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-indigo-50 to-blue-50 dark:from-gray-800 dark:to-gray-750 p-6 border-b border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-gradient-to-r from-indigo-500 to-blue-600 rounded-lg",children:e.jsx(T,{className:"text-2xl text-white"})}),e.jsx("h3",{className:"text-xl font-bold text-gray-800 dark:text-white",children:"Add Progress Update"})]})}),e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsx(H,{src:"/img/avatars/thumb-1.jpg"}),e.jsxs("div",{className:"flex-1",children:[e.jsx(w,{ref:b,textArea:!0,placeholder:"Describe what's been completed, any challenges, or next steps...",disabled:h,rows:3,className:"bg-gray-50 dark:bg-gray-700 border-gray-200 dark:border-gray-600"}),e.jsxs("div",{className:"flex justify-between items-center mt-4",children:[e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Progress will be saved with your comment"}),e.jsx(C,{variant:"solid",onClick:D,loading:h,disabled:h,icon:e.jsx(A,{}),className:"bg-gradient-to-r from-indigo-500 to-purple-600 hover:from-indigo-600 hover:to-purple-700 text-white font-semibold px-6 py-2 rounded-xl shadow-lg hover:shadow-xl transition-all duration-200",children:"Post Update"})]})]})]})})]})]})]})]})})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 via-white to-blue-50 dark:from-gray-900 dark:via-gray-850 dark:to-gray-900",children:e.jsx("div",{className:"container mx-auto p-6",children:e.jsxs(g,{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-xl border border-gray-100 dark:border-gray-700 overflow-hidden text-center p-8",children:[e.jsx("div",{className:"mb-4",children:e.jsx(P,{className:"text-6xl text-indigo-600 dark:text-indigo-400 mx-auto"})}),e.jsx("h3",{className:"text-xl font-bold text-gray-800 dark:text-white mb-2",children:"Team Not Assigned"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:"Please assign workers and a driver before updating progress"}),e.jsx(C,{variant:"solid",onClick:()=>window.location.href=`/app/teams-assign/${n}`,className:"bg-gradient-to-r from-indigo-500 to-purple-600 hover:from-indigo-600 hover:to-purple-700 text-white font-semibold px-6 py-3 rounded-xl shadow-lg hover:shadow-xl transition-all duration-200",children:"Assign Team"})]})})})};export{ze as default};
