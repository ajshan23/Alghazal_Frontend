import{r as y,j as e,v as M,a8 as T}from"./index-BqYC2zCO.js";import{N as j,t as w}from"./toast-BNCR3rph.js";import{F as B,a as f}from"./FormItem-FeS_vrRF.js";import{B as S}from"./Button-BZH25-Aw.js";import{S as E}from"./StickyFooter-DDBoG40l.js";import{F as O,a as A,b as g}from"./formik.esm-a5N8pODv.js";import{A as I}from"./index-B3h0cRGe.js";import{_ as q}from"./index-CErL3g3x.js";import{c as R,b as C,g as V}from"./index.esm-BBYGt9u8.js";import"./Alert-Praf8Fi9.js";import"./index-BhxlP8yV.js";import"./Badge-CrbEpOhk.js";import{D as $}from"./index-Bm5J6gtn.js";import"./Card-DiA6JKLe.js";import"./index-o6PoulbO.js";import"./Dialog-C85wTnEL.js";import"./Drawer-3BaRt1RV.js";import"./index-BNWCw_o_.js";import"./useUniqueId-BmsTzdR7.js";import{I as k}from"./Input-CF7OdvAt.js";import"./Upload-B1V-WMlx.js";import"./index-fwAOcRNC.js";import"./index-BkSrbwb3.js";import"./ScrollBar-bvGQZvnP.js";import{S as F}from"./Select-3fyDv9Rf.js";import"./Tag-DOC98LxQ.js";import{A as z}from"./AdaptableCard-DChiyDM1.js";import"./Views-B3egHxO-.js";import"./SvgIcon-C9XuCCBp.js";import{C as P}from"./ConfirmDialog-DSkSlVFC.js";import"./DataTable-CIH-lnfj.js";import{f as J}from"./format-CBpsKyOP.js";import{o as H,p as L,q as U}from"./api-CJl07x1A.js";import"./StatusIcon-CrxJz663.js";import"./CloseButton-L6WjsDsk.js";import"./chainedFunction-BxZSneMW.js";import"./proxy-DBs-aCG0.js";import"./context-CKHslMnf.js";import"./index-BLbmKy6n.js";import"./cloneDeep-DJN0yfLA.js";import"./hoist-non-react-statics.cjs-7CwaeXnJ.js";import"./floating-ui.react-DBGHfBho.js";import"./floating-ui.dom-B_iSk-nO.js";import"./_getPrototype-_N1fRqzo.js";import"./index-Z1Egzvm9.js";import"./index-DtRKDKi1.js";import"./toString-sucKyfO-.js";import"./index-BnTamqJo.js";import"./defineProperty-DRmM3rRU.js";import"./typeof-QjJsDpFa.js";import"./useThemeClass-CB8d6Ww5.js";const Y=new Date,N=y.forwardRef((n,r)=>{const{type:m,initialData:l={billType:"commission",billDate:new Date().toISOString().split("T")[0],amount:"",paymentMethod:"cash",remarks:""},onFormSubmit:u,onDiscard:h,onDelete:b}=n,x=R().shape({billDate:C().required("Date is required"),amount:V().typeError("Amount must be a number").required("Amount is required"),paymentMethod:C().required("Payment method is required"),remarks:C().max(500,"Remarks cannot exceed 500 characters")});return e.jsx(O,{innerRef:r,initialValues:{...l,billType:l.billType||"commission",billDate:l.billDate||new Date().toISOString().split("T")[0],amount:l.amount??"",paymentMethod:l.paymentMethod||"cash",remarks:l.remarks||""},validationSchema:x,onSubmit:async(c,{setSubmitting:p})=>{const a=new FormData;a.append("billType",c.billType),a.append("billDate",c.billDate),a.append("amount",c.amount.toString()),a.append("paymentMethod",c.paymentMethod),c.remarks&&a.append("remarks",c.remarks),await u(a,p)},enableReinitialize:!0,children:({values:c,touched:p,errors:a,isSubmitting:s,setFieldValue:v})=>e.jsx(A,{children:e.jsxs(B,{children:[e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:e.jsx("div",{className:"lg:col-span-2",children:e.jsxs(z,{divider:!0,className:"mb-4",children:[e.jsx("h5",{className:"mb-4",children:"Commission Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(f,{label:"Bill Type",children:e.jsx(g,{name:"billType",children:({field:i,form:o})=>e.jsx(F,{options:[{label:"Commission",value:"commission"}],value:{label:"Commission",value:"commission"},onChange:t=>o.setFieldValue(i.name,t==null?void 0:t.value),isDisabled:m==="edit"})})}),e.jsx(f,{label:"Date",invalid:!!a.billDate&&p.billDate,children:e.jsx(g,{name:"billDate",children:({field:i,form:o})=>e.jsx($,{placeholder:"Select Date",value:i.value?new Date(i.value):null,maxDate:Y,onChange:t=>o.setFieldValue(i.name,t?J(new Date(t.getFullYear(),t.getMonth(),t.getDate()),"yyyy-MM-dd"):"")})})}),e.jsx(f,{label:"Amount",invalid:!!a.amount&&p.amount,errorMessage:a.amount,children:e.jsx(g,{name:"amount",children:({field:i,form:o})=>e.jsx(k,{type:"number",autoComplete:"off",placeholder:"Amount",...i,onChange:t=>o.setFieldValue(i.name,t.target.value)})})}),e.jsx(f,{label:"Payment Method",invalid:!!a.paymentMethod&&p.paymentMethod,errorMessage:a.paymentMethod,children:e.jsx(g,{name:"paymentMethod",children:({field:i,form:o})=>e.jsx(F,{options:paymentMethodOptions,value:paymentMethodOptions.find(t=>t.value===i.value),onChange:t=>o.setFieldValue(i.name,t==null?void 0:t.value)})})}),e.jsx("div",{className:"md:col-span-2",children:e.jsx(f,{label:"Remarks",invalid:!!a.remarks&&p.remarks,errorMessage:a.remarks,children:e.jsx(g,{name:"remarks",children:({field:i,form:o})=>e.jsx(k,{textArea:!0,rows:3,autoComplete:"off",placeholder:"Enter any additional remarks or notes...",...i,onChange:t=>o.setFieldValue(i.name,t.target.value)})})})})]})]})})}),e.jsxs(E,{className:"-mx-8 px-8 flex items-center justify-between py-4",stickyClass:"border-t bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700",children:[e.jsx("div",{children:m==="edit"&&b&&e.jsx(_,{onDelete:b})}),e.jsxs("div",{className:"md:flex items-center",children:[e.jsx(S,{size:"sm",className:"ltr:mr-3 rtl:ml-3",type:"button",onClick:()=>h==null?void 0:h(),children:"Discard"}),e.jsx(S,{size:"sm",variant:"solid",loading:s,icon:e.jsx(I,{}),type:"submit",children:"Save"})]})]})]})})})});N.displayName="CommissionBillForm";const _=({onDelete:n})=>{const[r,m]=y.useState(!1),l=()=>{m(!1),n==null||n(m)},u=()=>{m(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(S,{className:"text-red-600",variant:"plain",size:"sm",icon:e.jsx(q,{}),type:"button",onClick:()=>m(!0),children:"Delete"}),e.jsx(P,{isOpen:r,type:"danger",title:"Delete Commission Entry",confirmButtonColor:"red-600",onClose:u,onRequestClose:u,onCancel:u,onConfirm:l,children:e.jsx("p",{children:"Are you sure you want to delete this commission entry?"})})]})},D={billType:"commission",billDate:new Date().toISOString().split("T")[0],amount:"",remarks:""},Ue=()=>{const n=M(),{id:r}=T(),[m,l]=y.useState(D),[u,h]=y.useState(!!r),[b,x]=y.useState(null);y.useEffect(()=>{if(!r){l(D),h(!1);return}(async()=>{try{h(!0);const s=await H(r);if(!(s!=null&&s.data))throw new Error("Invalid bill data received");l({billType:s.data.billType||"commission",billDate:s.data.billDate||D.billDate,amount:s.data.amount||"",remarks:s.data.remarks}),x(null)}catch(s){console.error("Error fetching bill:",s),x(s.message||"Failed to load bill data"),w.push(e.jsx(j,{title:"Failed to fetch commission data",type:"danger",duration:2500,children:s.message||"Something went wrong"}),{placement:"top-center"}),setTimeout(()=>n("/app/commission-bill-view"),2500)}finally{h(!1)}})()},[r,n]);const c=async(a,s)=>{var v,i,o,t;try{s(!0);const d=r?await L(r,a):await U(a);if([200,201].includes(d.status))w.push(e.jsxs(j,{title:`Successfully ${r?"updated":"added"} commission bill`,type:"success",duration:2500,children:["Commission bill ",r?"updated":"added"," successfully"]}),{placement:"top-center"}),n("/app/commission-bill-view");else throw new Error(((i=(v=d==null?void 0:d.response)==null?void 0:v.data)==null?void 0:i.message)||"Unexpected status code")}catch(d){console.error("Error during form submission:",d),w.push(e.jsx(j,{title:`Error ${r?"updating":"adding"} commission bill`,type:"danger",duration:2500,children:((t=(o=d==null?void 0:d.response)==null?void 0:o.data)==null?void 0:t.message)||d.message}),{placement:"top-center"})}finally{s(!1)}},p=()=>{JSON.stringify(m)!==JSON.stringify(D)?window.confirm("Are you sure you want to discard changes?")&&n("/app/commission-bill-view"):n("/app/commission-bill-view")};return u?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):b?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(j,{title:"Error loading commission",type:"danger",children:b})}):e.jsx(N,{type:r?"edit":"new",initialData:m,onFormSubmit:c,onDiscard:p})};export{Ue as default};
