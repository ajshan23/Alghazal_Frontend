import{r as x,j as e,v as ee,a8 as ae}from"./index-DGJe0h3_.js";import{t as T,N as H}from"./toast-DO-2lc6K.js";import{F as re,a as p}from"./FormItem-CS5k__-u.js";import{B}from"./Button-CQnyK8gC.js";import{S as se}from"./StickyFooter-B-P65R3j.js";import{F as te,a as ie,b as h,c as oe}from"./formik.esm-Bd7bPKfV.js";import{_ as Q,$ as ne}from"./index-DB0cxP-C.js";import{A as me}from"./index-CRCxGWKG.js";import{c as le,b as N,g as pe,e as de}from"./index.esm-Kw287qmC.js";import"./Alert-DQXwajGW.js";import"./index-BoJTJILF.js";import"./Badge-Bbo5QMXa.js";import"./index-CIbY2fIk.js";import"./Card-BM0eEatX.js";import"./index-BGu1WFOe.js";import"./Dialog-Cg-T3Ihd.js";import"./Drawer-CLVcPT2Q.js";import"./index-Bv5Pt-_w.js";import"./useUniqueId-D1PCBCG9.js";import{I}from"./Input-k-NORbeb.js";import{U as _}from"./Upload-BgdP_nuh.js";import"./index-1STGvrfH.js";import"./index-nUD77ZMI.js";import"./ScrollBar-nZR6U59l.js";import{S as ce}from"./Select-C04L81V4.js";import"./Tag-BPJKpn67.js";import{A as R}from"./AdaptableCard-BnEcGD7j.js";import"./Views-BFlyERhL.js";import"./SvgIcon-BuJBiwVw.js";import{C as ue}from"./ConfirmDialog-YYBqiHbX.js";import"./DataTable-CLMBeNRf.js";import{f as ge,e as fe,a as he}from"./api-BdbRXgjS.js";import"./StatusIcon-BdTPNP40.js";import"./CloseButton-CGoFVruc.js";import"./chainedFunction-BxZSneMW.js";import"./proxy-BoP70aqV.js";import"./context-DBc_qd6o.js";import"./index-C4_xw0Qz.js";import"./cloneDeep-DJN0yfLA.js";import"./hoist-non-react-statics.cjs-DodG7NJv.js";import"./floating-ui.react-DD89AqSX.js";import"./floating-ui.dom-B_iSk-nO.js";import"./_getPrototype-0ulQvO4z.js";import"./index-Blf2GdN6.js";import"./index-CXaN8JhO.js";import"./toString-Dkf6_Dxj.js";import"./index-TU9pDyqH.js";import"./defineProperty-DRmM3rRU.js";import"./typeof-QjJsDpFa.js";import"./useThemeClass-CWxsYH8M.js";import"./index-BX8TTJWs.js";const G=[{label:"Super Admin",value:"super_admin"},{label:"Admin",value:"admin"},{label:"Engineer",value:"engineer"},{label:"Finance",value:"finance"},{label:"Driver",value:"driver"},{label:"Worker",value:"worker"},{label:"Supervisor",value:"supervisor"}],M=["super_admin","admin"],W=x.forwardRef((y,d)=>{const{type:u,initialData:o={firstName:"",lastName:"",email:"",phoneNumbers:[""],role:"",password:"",profileImage:"",signatureImage:"",salary:void 0,accountNumber:"",emiratesId:"",emiratesIdDocument:"",passportNumber:"",passportDocument:"",iBANNumber:"",address:""},onFormSubmit:C,onDiscard:v,onDelete:L}=y,[S,F]=x.useState(null),[n,P]=x.useState(null),[w,g]=x.useState(null),[q,z]=x.useState(null),[t,D]=x.useState({profileImage:o.profileImage||"",signatureImage:o.signatureImage||"",emiratesIdDocument:o.emiratesIdDocument||"",passportDocument:o.passportDocument||""});x.useEffect(()=>{D({profileImage:o.profileImage||"",signatureImage:o.signatureImage||"",emiratesIdDocument:o.emiratesIdDocument||"",passportDocument:o.passportDocument||""})},[o]);const Y=le().shape({firstName:N().required("First name is required"),lastName:N().required("Last name is required"),email:N().email("Invalid email").required("Email is required"),password:u==="new"?N().required("Password is required"):N(),role:N(),phoneNumbers:de().of(N().matches(/^[0-9]+$/,"Phone number must be digits only")),salary:pe().nullable().transform((a,m)=>m===""?null:a).when("role",{is:a=>a&&!M.includes(a),then:a=>a.required("Salary is required for this role").min(.01,"Salary must be greater than 0"),otherwise:a=>a.nullable()}),accountNumber:N(),emiratesId:N(),passportNumber:N(),iBANNumber:N(),address:N()});return e.jsx(te,{innerRef:d,initialValues:{...o,phoneNumbers:Array.isArray(o.phoneNumbers)?o.phoneNumbers.length>0?o.phoneNumbers:[""]:typeof o.phoneNumbers=="string"?JSON.parse(o.phoneNumbers.replace(/'/g,'"')):[""],salary:o.salary||"",iBANNumber:o.iBANNumber||"",address:o.address||""},validationSchema:Y,onSubmit:async(a,{setSubmitting:m,setErrors:i})=>{var U,l,k;try{if(!a.email||!a.firstName||!a.lastName){i({email:a.email?void 0:"Email is required",firstName:a.firstName?void 0:"First name is required",lastName:a.lastName?void 0:"Last name is required"}),m(!1);return}if(u==="new"&&!a.password){i({password:"Password is required"}),m(!1);return}if(a.role&&!M.includes(a.role)&&(a.salary===void 0||a.salary===null||a.salary==="")){i({salary:"Salary is required for this role"}),m(!1);return}let b=a.phoneNumbers||[];Array.isArray(b)||(b=[b]);const E=b.filter(f=>f&&f.trim().length>0);for(let f=0;f<E.length;f++)if(!/^[0-9]+$/.test(E[f])){const $={};$[f]="Phone number must be digits only",i({phoneNumbers:$}),m(!1);return}const s=new FormData;if(s.append("firstName",a.firstName),s.append("lastName",a.lastName),s.append("email",a.email),u==="new"&&a.password&&s.append("password",a.password),u==="edit"&&a.password&&s.append("password",a.password),E.length>0&&s.append("phoneNumbers",JSON.stringify(E)),a.role&&s.append("role",a.role),a.salary!==void 0&&a.salary!==null&&a.salary!==""&&!M.includes(a.role||"worker")){const f=typeof a.salary=="string"?parseFloat(a.salary):a.salary;isNaN(f)||s.append("salary",f.toString())}a.accountNumber&&s.append("accountNumber",a.accountNumber),a.emiratesId&&s.append("emiratesId",a.emiratesId),a.passportNumber&&s.append("passportNumber",a.passportNumber),a.iBANNumber&&s.append("iBANNumber",a.iBANNumber),a.address&&s.append("address",a.address),S&&s.append("profileImage",S),n&&s.append("signatureImage",n),w&&s.append("emiratesIdDocument",w),q&&s.append("passportDocument",q),u==="edit"&&(!S&&t.profileImage&&s.append("profileImageUrl",t.profileImage),!n&&t.signatureImage&&s.append("signatureImageUrl",t.signatureImage),!w&&t.emiratesIdDocument&&s.append("emiratesIdDocumentUrl",t.emiratesIdDocument),!q&&t.passportDocument&&s.append("passportDocumentUrl",t.passportDocument),!a.profileImage&&t.profileImage&&s.append("removeProfileImage","true"),!a.signatureImage&&t.signatureImage&&s.append("removeSignatureImage","true"),!a.emiratesIdDocument&&t.emiratesIdDocument&&s.append("removeEmiratesIdDocument","true"),!a.passportDocument&&t.passportDocument&&s.append("removePassportDocument","true")),await C(s,m)}catch(b){m(!1),(U=b.message)!=null&&U.includes("Email already in use")?i({email:"Email already in use"}):(l=b.message)!=null&&l.includes("Salary is required")?i({salary:"Salary is required for this role"}):(k=b.message)!=null&&k.includes("Invalid phone numbers format")?i({phoneNumbers:"Invalid phone numbers format"}):console.error("Form submission error:",b)}},enableReinitialize:!0,children:({values:a,touched:m,errors:i,isSubmitting:U,setFieldValue:l})=>{const k=r=>{r.length>0?(F(r[0]),l("profileImage",r[0].name),D(c=>({...c,profileImage:""}))):(F(null),l("profileImage",t.profileImage||""))},b=r=>{r.length>0?(P(r[0]),l("signatureImage",r[0].name),D(c=>({...c,signatureImage:""}))):(P(null),l("signatureImage",t.signatureImage||""))},E=r=>{r.length>0?(g(r[0]),l("emiratesIdDocument",r[0].name),D(c=>({...c,emiratesIdDocument:""}))):(g(null),l("emiratesIdDocument",t.emiratesIdDocument||""))},s=r=>{r.length>0?(z(r[0]),l("passportDocument",r[0].name),D(c=>({...c,passportDocument:""}))):(z(null),l("passportDocument",t.passportDocument||""))},f=()=>{F(null),l("profileImage",""),D(r=>({...r,profileImage:""}))},$=()=>{P(null),l("signatureImage",""),D(r=>({...r,signatureImage:""}))},K=()=>{g(null),l("emiratesIdDocument",""),D(r=>({...r,emiratesIdDocument:""}))},X=()=>{z(null),l("passportDocument",""),D(r=>({...r,passportDocument:""}))},O=a.role&&!M.includes(a.role);return e.jsx(ie,{children:e.jsxs(re,{children:[e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:e.jsxs("div",{className:"lg:col-span-2",children:[e.jsxs(R,{divider:!0,className:"mb-4",children:[e.jsx("h5",{className:"mb-4",children:"Basic Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(p,{label:"First Name *",invalid:!!i.firstName&&m.firstName,errorMessage:i.firstName,children:e.jsx(h,{type:"text",autoComplete:"off",name:"firstName",placeholder:"First Name",component:I})}),e.jsx(p,{label:"Last Name *",invalid:!!i.lastName&&m.lastName,errorMessage:i.lastName,children:e.jsx(h,{type:"text",autoComplete:"off",name:"lastName",placeholder:"Last Name",component:I})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(p,{label:"Email *",invalid:!!i.email&&m.email,errorMessage:i.email,children:e.jsx(h,{type:"email",autoComplete:"off",name:"email",placeholder:"Email",component:I})}),e.jsx(p,{label:"Role",invalid:!!i.role&&m.role,errorMessage:i.role,children:e.jsx(h,{name:"role",children:({field:r,form:c})=>e.jsx(ce,{placeholder:"Select Role",field:r,form:c,options:G,value:G.find(j=>j.value===a.role),onChange:j=>{c.setFieldValue(r.name,(j==null?void 0:j.value)||"")}})})})]}),e.jsx(p,{label:"Address",children:e.jsx(h,{name:"address",children:({field:r,form:c})=>e.jsx(I,{as:"textarea",rows:3,placeholder:"Full Address",...r,onChange:j=>{c.setFieldValue(r.name,j.target.value)}})})}),e.jsxs(p,{label:O?"Salary *":"Salary",invalid:!!i.salary&&m.salary,errorMessage:i.salary,children:[e.jsx(h,{type:"number",autoComplete:"off",name:"salary",placeholder:O?"Enter salary (required)":"Enter salary (optional)",component:I,min:"0",step:"0.01"}),O&&e.jsx("div",{className:"mt-1 text-xs text-gray-500",children:"Salary is required and must be greater than 0 for this role"}),!O&&a.role&&e.jsxs("div",{className:"mt-1 text-xs text-gray-500",children:["Salary is optional for ",a.role," role"]})]})]}),e.jsxs(R,{divider:!0,className:"mb-4",children:[e.jsx("h5",{className:"mb-4",children:"Contact Information"}),e.jsx(oe,{name:"phoneNumbers",children:({push:r,remove:c})=>{var j;return e.jsxs("div",{className:"space-y-4",children:[(j=a.phoneNumbers)==null?void 0:j.map((Z,A)=>e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4 items-end border-b pb-4",children:[e.jsx(p,{label:`Phone Number ${A+1}`,invalid:!!(i.phoneNumbers&&i.phoneNumbers[A]&&m.phoneNumbers),errorMessage:i.phoneNumbers&&i.phoneNumbers[A],children:e.jsx(h,{name:`phoneNumbers.${A}`,component:I,placeholder:"Phone Number (digits only)",value:Z||"",onChange:V=>{const J=[...a.phoneNumbers];J[A]=V.target.value,l("phoneNumbers",J)}})}),e.jsx("div",{className:"flex justify-end",children:a.phoneNumbers.length>1&&e.jsx(B,{type:"button",size:"sm",variant:"plain",color:"red",icon:e.jsx(Q,{}),onClick:()=>c(A)})})]},A)),e.jsx(B,{type:"button",size:"sm",variant:"twoTone",icon:e.jsx(ne,{}),onClick:()=>r(""),children:"Add Phone Number"})]})}}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(p,{label:"Account Number",children:e.jsx(h,{type:"text",autoComplete:"off",name:"accountNumber",placeholder:"Bank Account Number",component:I})}),e.jsx(p,{label:"IBAN Number",children:e.jsx(h,{type:"text",autoComplete:"off",name:"iBANNumber",placeholder:"IBAN Number",component:I})})]})]}),e.jsxs(R,{divider:!0,className:"mb-4",children:[e.jsx("h5",{className:"mb-4",children:"Document Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(p,{label:"Emirates ID",children:e.jsx(h,{type:"text",autoComplete:"off",name:"emiratesId",placeholder:"Emirates ID Number",component:I})}),e.jsx(p,{label:"Passport Number",children:e.jsx(h,{type:"text",autoComplete:"off",name:"passportNumber",placeholder:"Passport Number",component:I})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(p,{label:"Emirates ID Document",children:e.jsx(_,{onChange:r=>E(r),onFileRemove:K,uploadLimit:1,defaultFile:t.emiratesIdDocument?[{name:"Emirates_ID_Document",url:t.emiratesIdDocument}]:[],fileList:w?[w]:[],accept:".pdf,.png,.jpeg,.jpg"})}),e.jsx(p,{label:"Passport Document",children:e.jsx(_,{onChange:r=>s(r),onFileRemove:X,uploadLimit:1,defaultFile:t.passportDocument?[{name:"Passport_Document",url:t.passportDocument}]:[],fileList:q?[q]:[],accept:".pdf,.png,.jpeg,.jpg"})})]})]}),e.jsxs(R,{divider:!0,className:"mb-4",children:[e.jsx("h5",{className:"mb-4",children:"Profile Images"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(p,{label:"Profile Image",children:e.jsx(_,{onChange:r=>k(r),onFileRemove:f,uploadLimit:1,defaultFile:t.profileImage?[{name:"profile.jpg",url:t.profileImage}]:[],fileList:S?[S]:[],accept:"image/*"})}),e.jsx(p,{label:"Signature Image",children:e.jsx(_,{onChange:r=>b(r),onFileRemove:$,uploadLimit:1,defaultFile:t.signatureImage?[{name:"signature.jpg",url:t.signatureImage}]:[],fileList:n?[n]:[],accept:"image/*"})})]})]}),e.jsxs(R,{divider:!0,className:"mb-4",children:[e.jsx("h5",{className:"mb-4",children:"Security"}),e.jsx(p,{label:"Password *",invalid:!!i.password&&m.password,errorMessage:i.password,children:e.jsx(h,{type:"password",autoComplete:"off",name:"password",placeholder:"Password",component:I})})]})]})}),e.jsxs(se,{className:"-mx-8 px-8 flex items-center justify-between py-4",stickyClass:"border-t bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700",children:[e.jsx("div",{children:u==="edit"&&L&&e.jsx(Ne,{onDelete:L})}),e.jsxs("div",{className:"md:flex items-center",children:[e.jsx(B,{size:"sm",className:"ltr:mr-3 rtl:ml-3",type:"button",onClick:()=>v==null?void 0:v(),children:"Discard"}),e.jsx(B,{size:"sm",variant:"solid",loading:U,icon:e.jsx(me,{}),type:"submit",children:"Save"})]})]})]})})}})});W.displayName="UserForm";const Ne=({onDelete:y})=>{const[d,u]=x.useState(!1),o=()=>{u(!1),y==null||y(u)},C=()=>{u(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(B,{className:"text-red-600",variant:"plain",size:"sm",icon:e.jsx(Q,{}),type:"button",onClick:()=>u(!0),children:"Delete"}),e.jsx(ue,{isOpen:d,type:"danger",title:"Delete user",confirmButtonColor:"red-600",onClose:C,onRequestClose:C,onCancel:C,onConfirm:o,children:e.jsx("p",{children:"Are you sure you want to delete this user?"})})]})},fa=()=>{const y=ee(),{id:d}=ae(),[u,o]=x.useState(null),[C,v]=x.useState(!!d);x.useEffect(()=>{d&&(async()=>{try{const n=await ge(d);console.log("response:",n),o({...n.data,phoneNumbers:n.data.phoneNumbers||[""],profileImage:n.data.profileImage||"",signatureImage:n.data.signatureImage||"",emiratesIdDocument:n.data.emiratesIdDocument||"",passportDocument:n.data.passportDocument||"",salary:n.data.salary||0}),v(!1)}catch(n){console.error("Error fetching user:",n),v(!1),T.push(e.jsx(H,{title:"Failed to fetch user data",type:"danger",duration:2500,children:n.message}),{placement:"top-center"}),y("/app/user-list")}})()},[d,y]);const L=async(F,n)=>{var P,w;n(!0);try{let g;if(d?g=await fe(d,F):g=await he(F),g.status===(d?200:201))n(!1),T.push(e.jsxs(H,{title:`Successfully ${d?"updated":"added"} user`,type:"success",duration:2500,children:["User ",d?"updated":"added"," successfully"]}),{placement:"top-center"}),y("/app/user-list");else throw console.log(g),new Error(`Unexpected status code: ${g.response.data.message}`)}catch(g){console.error("Error during form submission:",g),n(!1),T.push(e.jsx(H,{title:`Error ${d?"updating":"adding"} user`,type:"danger",duration:2500,children:((w=(P=g.response)==null?void 0:P.data)==null?void 0:w.message)||g.message}),{placement:"top-center"})}},S=()=>{y("/app/user-list")};return C?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):e.jsx(W,{type:d?"edit":"new",initialData:u||{firstName:"",lastName:"",email:"",phoneNumbers:[""],role:"",password:"",profileImage:"",signatureImage:"",emiratesIdDocument:"",passportDocument:"",salary:0,accountNumber:"",emiratesId:"",passportNumber:""},onFormSubmit:L,onDiscard:S})};export{fa as default};
