import{a8 as E,v as T,r as a,b as k,j as e,T as _}from"./index-DGJe0h3_.js";import"./Alert-DQXwajGW.js";import{A as z}from"./index-BoJTJILF.js";import{B as H}from"./Badge-Bbo5QMXa.js";import{B as o}from"./Button-CQnyK8gC.js";import"./index-CIbY2fIk.js";import{C as W}from"./Card-BM0eEatX.js";import"./index-BGu1WFOe.js";import"./Dialog-Cg-T3Ihd.js";import"./Drawer-CLVcPT2Q.js";import"./index-Bv5Pt-_w.js";import"./FormItem-CS5k__-u.js";import"./useUniqueId-D1PCBCG9.js";import"./Input-k-NORbeb.js";import"./Upload-BgdP_nuh.js";import"./index-1STGvrfH.js";import{t as c,N as m}from"./toast-DO-2lc6K.js";import"./index-nUD77ZMI.js";import"./ScrollBar-nZR6U59l.js";import"./Select-C04L81V4.js";import"./Tag-BPJKpn67.js";import{H as R,ay as F,P as I}from"./index-DB0cxP-C.js";import{i as L,j as O}from"./api-C-Yc0xFS.js";import{u as G}from"./useThemeClass-CWxsYH8M.js";import"./Views-BFlyERhL.js";import"./SvgIcon-BuJBiwVw.js";import"./DataTable-CLMBeNRf.js";import{F as U}from"./index-C8abeZB5.js";import{M as X}from"./MarkAttendanceModal-GY93v5Kx.js";import"./StatusIcon-BdTPNP40.js";import"./CloseButton-CGoFVruc.js";import"./proxy-BoP70aqV.js";import"./floating-ui.react-DD89AqSX.js";import"./floating-ui.dom-B_iSk-nO.js";import"./index-C4_xw0Qz.js";import"./context-DBc_qd6o.js";import"./_getPrototype-0ulQvO4z.js";import"./index-Blf2GdN6.js";import"./index-CXaN8JhO.js";import"./toString-Dkf6_Dxj.js";import"./chainedFunction-BxZSneMW.js";import"./index-TU9pDyqH.js";import"./defineProperty-DRmM3rRU.js";import"./typeof-QjJsDpFa.js";import"./hoist-non-react-statics.cjs-DodG7NJv.js";import"./cloneDeep-DJN0yfLA.js";import"./index-BX8TTJWs.js";const Fe=()=>{const{projectId:r}=E();T(),G();const[M,l]=a.useState(!0),[p,x]=a.useState(!1),[i,A]=a.useState(null),[h,f]=a.useState([]),[S,w]=a.useState(k().format("DD MMM YYYY")),[C,g]=a.useState(!1),[u,y]=a.useState(null),[j,Y]=a.useState("present"),N=async()=>{try{l(!0);const t=await L(r);A(t.data.data.project),f(t.data.data.workers),w(k(t.data.data.date).format("DD MMM YYYY"))}catch(t){c.push(e.jsx(m,{title:"Error fetching attendance",type:"danger",children:t.message}))}finally{l(!1)}};a.useEffect(()=>{N()},[r]);const v=async(t,s,B)=>{try{x(!0),await O({projectId:r,userId:t,present:s,hour:s?B:0}),f(n=>n.map(d=>d._id===t?{...d,present:s,markedBy:{_id:"current-user",firstName:"You",lastName:""},markedAt:new Date}:d)),c.push(e.jsx(m,{title:"Success",type:"success",children:"Attendance marked successfully"}))}catch(n){c.push(e.jsx(m,{title:"Error marking attendance",type:"danger",children:n.message}))}finally{x(!1)}},D=(t,s)=>{y(t),Y(s),g(!0)},b=t=>{y(null),g(!1)},P=(t,s)=>{u&&(v(u,j==="present",s),b())};return M?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx(_,{})}):e.jsxs("div",{className:"container mx-auto px-4 h-full",children:[e.jsx(W,{header:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-bold mb-1",children:"Attendance Management"}),e.jsxs("p",{className:"text-gray-500 dark:text-gray-400",children:[i==null?void 0:i.projectName," - ",S]})]}),e.jsx("div",{className:"flex items-center gap-2 mt-2 md:mt-0",children:e.jsx(o,{size:"sm",variant:"plain",icon:e.jsx(I,{}),onClick:N,children:"Refresh"})})]}),children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-600",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Worker"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Contact"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-600",children:h.length>0?h.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(z,{size:"sm",src:t.profileImage,className:"mr-3",icon:e.jsx(U,{})}),e.jsx("div",{children:e.jsxs("div",{className:"font-medium text-gray-900 dark:text-gray-200",children:[t.firstName," ",t.lastName]})})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-gray-500 dark:text-gray-400",children:t.mobileNumber||"N/A"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx(H,{content:t.present?"Present":"Absent",innerClass:`${t.present?"bg-emerald-500 text-white":"bg-red-500 text-white"}`})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(o,{size:"xs",variant:"solid",color:"green",icon:e.jsx(R,{}),onClick:()=>D(t._id,"present"),disabled:p||t.present,children:"Present"}),e.jsx(o,{size:"xs",variant:"solid",color:"red",icon:e.jsx(F,{}),onClick:()=>v(t._id,!1),disabled:p||!t.present,children:"Absent"})]})})]},t._id)):e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"px-6 py-4 text-center text-gray-500 dark:text-gray-400",children:"No workers assigned to this project"})})})]})})}),e.jsx(X,{isOpen:C,onClose:b,onConfirm:P,modalType:j})]})};export{Fe as default};
